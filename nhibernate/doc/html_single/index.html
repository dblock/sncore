<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>NHibernate Documentation 1.0.3.0</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="NHibernate.Documentation"></a>NHibernate Documentation 1.0.3.0</h1></div><div><div class="author"><h3 class="author"><span class="firstname">
        <a href="http://www.nhibernate.org/" target="_blank">NHibernate</a>
      </span></h3><span class="contrib">Thanks to all the contributors!</span></div></div><div><p class="releaseinfo">Status: Production/Stable. Generated on 2006-11-02 19:17:56Z.</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#architecture">1. Architecture</a></span></dt><dd><dl><dt><span class="sect1"><a href="#architecture-overview">1.1. Overview</a></span></dt></dl></dd><dt><span class="chapter"><a href="#session-configuration">2. ISessionFactory Configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#configuration-programmatic">2.1. Programmatic Configuration</a></span></dt><dt><span class="sect1"><a href="#configuration-sessionfactory">2.2. Obtaining an ISessionFactory</a></span></dt><dt><span class="sect1"><a href="#configuration-userado">2.3. User provided ADO.NET connection</a></span></dt><dt><span class="sect1"><a href="#configuration-nhibernateado">2.4. NHibernate provided ADO connection</a></span></dt><dt><span class="sect1"><a href="#configuration-optional">2.5. Optional configuration properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configuration-optional-dialects">2.5.1. SQL Dialects</a></span></dt><dt><span class="sect2"><a href="#configuration-optional-outerjoin">2.5.2. Outer Join Fetching</a></span></dt><dt><span class="sect2"><a href="#configuration-optional-cacheprovider">2.5.3. Custom <code class="literal">CacheProvider</code></a></span></dt><dt><span class="sect2"><a href="#configuration-optional-querysubstitution">2.5.4. Query Language Substitution</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configuration-logging">2.6. Logging</a></span></dt></dl></dd><dt><span class="chapter"><a href="#persistent-classes">3. Persistent Classes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#persistent-classes-poco">3.1. A simple POCO example</a></span></dt><dd><dl><dt><span class="sect2"><a href="#persistent-classes-poco-accessors">3.1.1. Declare getters and setters for persistent fields (optional)</a></span></dt><dt><span class="sect2"><a href="#persistent-classes-poco-constructor">3.1.2. Implement a default constructor</a></span></dt><dt><span class="sect2"><a href="#persistent-classes-poco-identifier">3.1.3. Provide an identifier property (optional)</a></span></dt><dt><span class="sect2"><a href="#persistent-classes-poco-sealed">3.1.4. Prefer non-sealed classes (optional)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#persistent-classes-inheritance">3.2. Implementing inheritence</a></span></dt><dt><span class="sect1"><a href="#persistent-classes-equalshashcode">3.3. Implementing <code class="literal">Equals()</code> and <code class="literal">GetHashCode()</code></a></span></dt><dt><span class="sect1"><a href="#persistent-classes-lifecycle">3.4. Lifecycle Callbacks</a></span></dt><dt><span class="sect1"><a href="#persistent-classes-validatable">3.5. Validatable callback</a></span></dt><dt><span class="sect1"><a href="#persistent-classes-attribute">3.6. Using Attributes instead of XML</a></span></dt></dl></dd><dt><span class="part"><a href="#part-mapping">I. NHibernate Mapping</a></span></dt><dd><dl><dt><span class="chapter"><a href="#basic-mapping">4. Basic O/R Mapping</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mapping-declaration">4.1. Mapping declaration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mapping-declaration-doctype">4.1.1. Schema</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-mapping">4.1.2. hibernate-mapping</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-class">4.1.3. class</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration_id">4.1.4. id</a></span></dt><dd><dl><dt><span class="sect3"><a href="#mapping-declaration-id-generator">4.1.4.1. generator</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-hilo">4.1.4.2. Hi/Lo Algorithm</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-uuid-hex">4.1.4.3. UUID Hex Algorithm</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-uuid-string">4.1.4.4. UUID String Algorithm</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-guid">4.1.4.5. GUID Algorithms</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-sequences">4.1.4.6. Identity columns and Sequences</a></span></dt><dt><span class="sect3"><a href="#mapping-declaration-id-assigned">4.1.4.7. Assigned Identifiers</a></span></dt></dl></dd><dt><span class="sect2"><a href="#mapping-declaration-compositeid">4.1.5. composite-id</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-discriminator">4.1.6. discriminator</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-version">4.1.7. version (optional)</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-timestamp">4.1.8. timestamp (optional)</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-property">4.1.9. property</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-manytoone">4.1.10. many-to-one</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-onetoone">4.1.11. one-to-one</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-component">4.1.12. component</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-subclass">4.1.13. subclass</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-joinedsubclass">4.1.14. joined-subclass</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-collections">4.1.15. map, set, list, bag</a></span></dt><dt><span class="sect2"><a href="#mapping-declaration-import">4.1.16. import</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mapping-types">4.2. NHibernate Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mapping-types-entitiesvalues">4.2.1. Entities and values</a></span></dt><dt><span class="sect2"><a href="#mapping-types-basictypes">4.2.2. Basic value types</a></span></dt><dt><span class="sect2"><a href="#mapping-types-custom">4.2.3. Custom value types</a></span></dt><dt><span class="sect2"><a href="#mapping-types-anymapping">4.2.4. Any type mappings</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mapping-quotedidentifiers">4.3. SQL quoted identifiers</a></span></dt><dt><span class="sect1"><a href="#mapping-modularfiles">4.4. Modular mapping files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#collections">5. Collection Mapping</a></span></dt><dd><dl><dt><span class="sect1"><a href="#collections-persistent">5.1. Persistent Collections</a></span></dt><dt><span class="sect1"><a href="#collections-mapping">5.2. Mapping a Collection</a></span></dt><dt><span class="sect1"><a href="#collections-ofvalues">5.3. Collections of Values and Many-To-Many Associations</a></span></dt><dt><span class="sect1"><a href="#collections-onetomany">5.4. One-To-Many Associations</a></span></dt><dt><span class="sect1"><a href="#collections-lazy">5.5. Lazy Initialization</a></span></dt><dt><span class="sect1"><a href="#collections-sorted">5.6. Sorted Collections</a></span></dt><dt><span class="sect1"><a href="#collections-idbag">5.7. Using an &lt;idbag&gt;</a></span></dt><dt><span class="sect1"><a href="#collections-bidirectional">5.8. Bidirectional Associations</a></span></dt><dt><span class="sect1"><a href="#collections-ternary">5.9. Ternary Associations</a></span></dt><dt><span class="sect1"><a href="#collections-heterogeneous">5.10. Heterogeneous Associations</a></span></dt><dt><span class="sect1"><a href="#collections-example">5.11. Collection examples</a></span></dt></dl></dd><dt><span class="chapter"><a href="#associations">6. Association Mappings</a></span></dt><dd><dl><dt><span class="sect1"><a href="#assoc-intro">6.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#assoc-unidirectional">6.2. Unidirectional associations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#assoc-unidirectional-m21">6.2.1. many to one</a></span></dt><dt><span class="sect2"><a href="#assoc-unidirectional-121">6.2.2. one to one</a></span></dt><dt><span class="sect2"><a href="#assoc-unidirectional-12m">6.2.3. one to many</a></span></dt></dl></dd><dt><span class="sect1"><a href="#assoc-unidirectional-join">6.3. Unidirectional associations with join tables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#assoc-unidirectional-join-12m">6.3.1. one to many</a></span></dt><dt><span class="sect2"><a href="#assoc-unidirectional-join-m21">6.3.2. many to one</a></span></dt><dt><span class="sect2"><a href="#assoc-unidirectional-join-121">6.3.3. one to one</a></span></dt><dt><span class="sect2"><a href="#assoc-unidirectional-join-m2m">6.3.4. many to many</a></span></dt></dl></dd><dt><span class="sect1"><a href="#assoc-bidirectional">6.4. Bidirectional associations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#assoc-bidirectional-m21">6.4.1. one to many / many to one</a></span></dt><dt><span class="sect2"><a href="#assoc-bidirectional-121">6.4.2. one to one</a></span></dt></dl></dd><dt><span class="sect1"><a href="#assoc-bidirectional-join">6.5. Bidirectional associations with join tables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#assoc-bidirectional-join-12m">6.5.1. one to many / many to one</a></span></dt><dt><span class="sect2"><a href="#assoc-bidirectional-join-121">6.5.2. one to one</a></span></dt><dt><span class="sect2"><a href="#assoc-bidirectional-join-m2m">6.5.3. many to many</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#example-parentchild">7. Example: Parent/Child</a></span></dt><dd><dl><dt><span class="sect1"><a href="#example-parentchild-collections">7.1. A note about collections</a></span></dt><dt><span class="sect1"><a href="#example-parentchild-bidir">7.2. Bidirectional one-to-many</a></span></dt><dt><span class="sect1"><a href="#example-parentchild-cascades">7.3. Cascading lifecycle</a></span></dt><dt><span class="sect1"><a href="#example-parentchild-update">7.4. Using cascading <code class="literal">update()</code></a></span></dt><dt><span class="sect1"><a href="#example-parentchild-conclusion">7.5. Conclusion</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#part-contrib">II. NHibernateContrib Documentation</a></span></dt><dd><dl><dt><span class="preface"><a href="#contrib-preface">Preface</a></span></dt><dt><span class="chapter"><a href="#caches">8. NHibernate.Caches</a></span></dt><dd><dl><dt><span class="section"><a href="#NHibernate.Caches-howto">8.1. How to use them?</a></span></dt><dt><span class="section"><a href="#NHibernate.Caches.Prevalence">8.2. Prevalence Cache Configuration</a></span></dt><dt><span class="section"><a href="#NHibernate.Caches.SysCache">8.3. SysCache Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mapping-attributes">9. NHibernate.Mapping.Attributes</a></span></dt><dd><dl><dt><span class="section"><a href="#mapping-attributes-howto">9.1. How to use it?</a></span></dt><dt><span class="section"><a href="#mapping-attributes-tips">9.2. Tips</a></span></dt><dt><span class="section"><a href="#mapping-attributes-todo">9.3. Know issues and TODOs</a></span></dt><dt><span class="section"><a href="#mapping-attributes-devnotes">9.4. Developer Notes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tool-hbm2net">10. NHibernate.Tool.hbm2net</a></span></dt><dt><span class="chapter"><a href="#nullables">11. Nullables</a></span></dt><dd><dl><dt><span class="section"><a href="#Nullables-howto">11.1. How to use it?</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#support">12. More information and support</a></span></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>
		Working with object-oriented software and a relational database can be cumbersome
		and time consuming in today's enterprise environments. NHibernate is an object/relational
		mapping tool for .NET environments. The term object/relational mapping (ORM) refers to
		the technique of mapping a data representation from an object model to a relational
		data model with a SQL-based schema.
	</p><p>
		NHibernate not only takes care of the mapping from .NET classes to
		database tables (and from .NET data types to SQL data types), but also provides data
		query and retrieval facilities and can significantly reduce development time otherwise
		spent with manual data handling in SQL and ADO.NET.
	</p><p>
		NHibernate's goal is to relieve the developer from 95 percent of common data persistence
		related programming tasks. NHibernate may not be the best solution for data-centric
		applications that only use stored-procedures to implement the business logic in the
		database, it is most useful with object-oriented domain models and business logic in
		the .NET-based middle-tier. However, NHibernate can certainly help you to remove or
		encapsulate vendor-specific SQL code and will help with the common task of result set
		translation from a tabular representation to a graph of objects.
	</p><p>
		If you are new to NHibernate and Object/Relational Mapping or even .NET,
		please follow these steps:
	</p><div class="orderedlist"><ol type="1"><li><p>
				Read <a href="#architecture" title="Chapter 1. Architecture">Chapter 1, <i>Architecture</i></a> to understand the environments where
				NHibernate can be used.
			</p></li><li><p>
				FAQs are answered on the NHibernate website.
			</p></li></ol></div><p>
		If you have questions, use the user forum linked on the NHibernate website. We also
		provide a JIRA issue trackings system for bug reports and feature requests. If you
		are interested in the development of NHibernate, join the developer mailing list. If
		you are interested in translating this documentation into your language, contact us
		on the developer mailing list.
	</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="architecture"></a>Chapter 1. Architecture</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="architecture-overview"></a>1.1. Overview</h2></div></div></div><p>
			A (very) high-level view of the NHibernate architecture:
		</p><div class="mediaobject" align="center"><img src="overview.gif" align="middle"></div><p>
			This diagram shows NHibernate using the database and configuration data to
			provide persistence services (and persistent objects) to the application.
		</p><p>
			We would like to show a more detailed view of the runtime architecture.
			Unfortunately, NHibernate is flexible and supports several approaches. We will
			show the two extremes. The "lite" architecture has the application
			provide its own ADO.NET connections and manage its own transactions. This approach
			uses a minimal subset of NHibernate's APIs:
		</p><div class="mediaobject" align="center"><img src="lite.gif" align="middle"></div><p>
			The "full cream" architecture abstracts the application away from the
			underlying ADO.NET API and lets NHibernate take care of the details.
		</p><div class="mediaobject" align="center"><img src="full_cream.gif" align="middle"></div><p>
			Heres some definitions of the objects in the diagrams:

			</p><div class="variablelist"><dl><dt><span class="term">SessionFactory (<code class="literal">NHibernate.ISessionFactory</code>)</span></dt><dd><p>
							A threadsafe (immutable) cache of compiled mappings for a single database.
							A factory for <code class="literal">Session</code> and a client of
							<code class="literal">ConnectionProvider</code>. Might hold an optional (second-level)
							cache of data that is reusable between transactions, at a
							process- or cluster-level.
						</p></dd><dt><span class="term">Session (<code class="literal">NHibernate.ISession</code>)</span></dt><dd><p>
							A single-threaded, short-lived object representing a conversation between
							the application and the persistent store. Wraps an ADO.NET connection. Factory
							for <code class="literal">Transaction</code>. Holds a mandatory (first-level) cache
							of persistent objects, used when navigating the object graph or looking up
							objects by identifier.
						</p></dd><dt><span class="term">Persistent Objects and Collections</span></dt><dd><p>
							Short-lived, single threaded objects containing persistent state and business
							function. These might be ordinary objects, the only special thing about
							them is that they are currently associated with (exactly one)
							<code class="literal">Session</code>. As soon as the <code class="literal">Session</code> is closed,
							they will be detached and free to use in any application layer (e.g. directly
							as data transfer objects to and from presentation).
						</p></dd><dt><span class="term">Transient Objects and Collections</span></dt><dd><p>
							Instances of persistent classes that are not currently associated with a
							<code class="literal">Session</code>. They may have been instantiated by
							the application and not (yet) persisted or they may have been instantiated by a
							closed <code class="literal">Session</code>.
						</p></dd><dt><span class="term">Transaction (<code class="literal">NHibernate.ITransaction</code>)</span></dt><dd><p>
							(Optional) A single-threaded, short-lived object used by the application to
							specify atomic units of work. Abstracts application from underlying ADO.NET 
							transaction. A <code class="literal">Session</code> might span several
							<code class="literal">Transaction</code>s in some cases.
						</p></dd><dt><span class="term">ConnectionProvider (<code class="literal">NHibernate.Connection.ConnectionProvider</code>)</span></dt><dd><p>
							(Optional) A factory for ADO.NET connections. Abstracts application from
							underlying <code class="literal">IDbConnection</code>. Not exposed to application, 
							but can be extended/implemented by the developer.
						</p></dd><dt><span class="term">TransactionFactory (<code class="literal">net.sf.hibernate.TransactionFactory</code>)</span></dt><dd><p>
							(Optional) A factory for <code class="literal">Transaction</code> instances. Not exposed to the
							application, but can be extended/implemented by the developer.
						</p></dd></dl></div><p>
		</p><p>
			Given a "lite" architecture, the application bypasses the
			<code class="literal">Transaction</code>/<code class="literal">TransactionFactory</code> and/or
			<code class="literal">ConnectionProvider</code> APIs to talk to ADO.NET directly.
		</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="session-configuration"></a>Chapter 2. ISessionFactory Configuration</h2></div></div></div><p>
        Because NHibernate is designed to operate in many different environments, there
        are a large number of configuration parameters. Fortunately, most have sensible
        default values. The NHibernate.Test.dll contains an example of the hibernate 
        properties in an <code class="literal">app.config</code> file that shows the various options.
    </p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-programmatic"></a>2.1. Programmatic Configuration</h2></div></div></div><p>
            An instance of <code class="literal">NHibernate.Cfg.Configuration</code>
            represents an entire set of mappings of an application's .NET types to a
            SQL database. The <code class="literal">Configuration</code> is used to build a
            (immutable) <code class="literal">ISessionFactory</code>. The mappings are compiled
            from various XML mapping files.
        </p><p>
            You may obtain a <code class="literal">Configuration</code> instance by
            instantiating it directly. Heres an example of setting up a datastore from 
            mappings defined in two XML configuration files (in the same folder as the exe):
        </p><pre class="programlisting">Configuration cfg = new Configuration()
    .AddXmlFile("Item.hbm.xml")
    .AddXmlFile("Bid.hbm.xml");</pre><p>
            An alternative (usually better) way is to let NHibernate load a mapping file
            using <code class="literal">GetManifestResourceStream()</code>:
        </p><pre class="programlisting">Configuration cfg = new Configuration()
    .AddClass( typeof(NHibernate.Auction.Item) )
    .AddClass( typeof(NHibernate.Auction.Bid) );</pre><p>
            Then NHibernate will look for mapping files named
            <code class="literal">NHibernate.Auction.Item.hbm.xml</code> and
            <code class="literal">NHibernate.Auction.Bid.hbm.xml</code> as an Embedded Resource 
            in the Assembly those types are contained in.  This approach eliminates 
            any hardcoded filenames.
        </p><p>
            Another alternative (probably best) way is to let NHibernate load all of 
            the mapping files contained in an Assembly:
        </p><pre class="programlisting">Configuration cfg = new Configuration()
    .AddAssembly( "NHibernate.Auction" );</pre><p>
            Then NHibernate will look through the Assembly for any resources that
            end with <code class="literal">hbm.xml</code>.  This approach eliminates 
            any hardcoded filenames and ensures the mapping files in the Assembly
            get added.
        </p><p>
			If VisualStudio.NET or NAnt is used to build the Assembly then make sure
			that the hbm.xml files are added as <code class="literal">Embedded Resources</code>.
        </p><p>
            A <code class="literal">Configuration</code> also specifies various optional properties:
        </p><pre class="programlisting">Hashtable props = new Hashtable();
...
Configuration cfg = new Configuration()
    .AddClass( typeof(NHibernate.Auction.Item) )
    .AddClass( typeof(NHibernate.Auction.Bid) );
cfg.Properties = props;</pre><p>
            A <code class="literal">Configuration</code> is intended as a configuration-time object, to be
            discarded once a <code class="literal">SessionFactory</code> is built.
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-sessionfactory"></a>2.2. Obtaining an ISessionFactory</h2></div></div></div><p>
            When all mappings have been parsed by the <code class="literal">Configuration</code>, the application
            must obtain a factory for <code class="literal">ISession</code> instances. This factory is intended
            to be shared by all application threads:
        </p><pre class="programlisting">ISessionFactory sessions = cfg.BuildSessionFactory();</pre><p>
            However, NHibernate does allow your application to instantiate more than one
            <code class="literal">ISessionFactory</code>. This is useful if you are using more than one database.
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-userado"></a>2.3. User provided ADO.NET connection</h2></div></div></div><p>
            An <code class="literal">ISessionFactory</code> may open an <code class="literal">ISession</code> on 
            a user-provided ADO.NET connection. This design choice frees the application to 
            obtain ADO.NET connections wherever it pleases:
        </p><pre class="programlisting">IDbConnection conn = myapp.GetOpenConnection();
ISession session = sessions.OpenSession(conn);

// do some data access work</pre><p>
            The application must be careful not to open two concurrent
            <code class="literal">ISession</code>s on the same ADO.NET connection!
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-nhibernateado"></a>2.4. NHibernate provided ADO connection</h2></div></div></div><p>
            Alternatively, you can have the <code class="literal">ISessionFactory</code>
            open connections for you. The <code class="literal">ISessionFactory</code>
            must be provided with ADO connection properties in one of the
            following ways:
        </p><div class="orderedlist"><ol type="1" compact><li><p>
                    Pass an instance of <code class="literal">IDictionary</code> to
                    <code class="literal">Configuration.Properties</code>.
                </p></li><li><p>
                    Add the properties to a configuration section that is a  
                    <code class="literal">System.Configuration.NameValueSectionHandler</code>
                    named <code class="literal">nhibernate</code>.                    
                </p></li><li><p>
                    Include <code class="literal">&lt;property&gt;</code> elements in
                    <code class="literal">hibernate.cfg.xml</code> (discussed later).
                </p></li></ol></div><p>
            If you take this approach, opening an <code class="literal">ISession</code> is as simple as:
        </p><pre class="programlisting">ISession session = sessions.OpenSession(); // open a new Session
// do some data access work, an ADO connection will be used on demand</pre><p>
            All NHibernate property names and semantics are defined on the class 
            <code class="literal">NHibernate.Cfg.Environment</code>. We will now describe the most
            important settings for ADO connection configuration.
        </p><p>
            NHibernate will obtain connections using the ADO.NET Data Provider
            if you set the following properties:
        </p><div class="table"><a name="id403208"></a><p class="title"><b>Table 2.1. NHibernate ADO.NET Properties</b></p><table summary="NHibernate ADO.NET Properties" border="1"><colgroup><col><col></colgroup><thead><tr><th>Property name</th><th>Purpose</th></tr></thead><tbody><tr><td>
					<code class="literal">hibernate.connection.provider_class</code>
				</td><td>
					The type of a custom <code class="literal">IConnectionProvider</code>.
					<p>
						<span class="strong"><strong>eg.</strong></span> 
						<code class="literal">full.classname.of.ConnectionProvider</code> if the Provider 
						is built into NHibernate, or <code class="literal">full.classname.of.ConnectionProvider, 
						assembly</code> if using an implementation of IConnectionProvider not 
						included in NHibernate.
					</p>
				</td></tr><tr><td>
                    <code class="literal">hibernate.connection.driver_class</code>
                </td><td>
					The type of a custom <code class="literal">IDriver</code>.
					<p>
						<code class="literal">full.classname.of.Driver</code> if the Driver 
						is built into NHibernate, or <code class="literal">full.classname.of.Driver, assembly</code> 
						if using an implementation of IDriver not included in NHibernate.
					</p>                  
                </td></tr><tr><td>
                    <code class="literal">hibernate.connection.connection_string</code>
                </td><td>
                    Connection string to use to obtain the connection.
                </td></tr><tr><td>
					<code class="literal">hibernate.connection.isolation</code>
				</td><td>
					Set the ADO.NET transaction isolation level. Check
					<code class="literal">System.Data.IsolationLevel</code> for meaningful values 
					and the database's documentation to ensure that level is supported.
					<p>
						<span class="strong"><strong>eg.</strong></span> 
						<code class="literal">Chaos, ReadCommitted, ReadUncommitted, RepeatableRead, Serializable, Unspecified </code>
					</p>
				</td></tr></tbody></table></div><p>
            This is an example of how to specify the database connection properties inside a 
            <code class="literal">web.config</code>:
        </p><a name="we-config-configuration"></a><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;configuration&gt;
	&lt;configSections&gt;
		&lt;section name="nhibernate" type="System.Configuration.NameValueSectionHandler, System,
					Version=1.0.5000.0,Culture=neutral, PublicKeyToken=b77a5c561934e089" /&gt;
		&lt;section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" /&gt;
	&lt;/configSections&gt;
	
	&lt;nhibernate&gt;
		&lt;add 
			key="hibernate.connection.provider"          
			value="NHibernate.Connection.DriverConnectionProvider" 
		/&gt;
		&lt;add 
			key="hibernate.connection.driver_class"          
			value="NHibernate.Driver.SqlClientDriver" 
		/&gt;
		&lt;add 
			key="hibernate.connection.connection_string" 
			value="Server=127.0.0.1;Initial Catalog=thedatabase;Integrated Security=SSPI" 
		/&gt;
		&lt;add 
			key="hibernate.connection.isolation"
			value="ReadCommitted"
		/&gt;
		&lt;add 
			key="hibernate.dialect"                      
			value="NHibernate.Dialect.MsSql2000Dialect" 
		/&gt;
		
	&lt;/nhibernate&gt;
	
	&lt;!-- log4net (required by NHibernate) and other app specific config follows --&gt;
&lt;/configuration&gt;
	</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-optional"></a>2.5. Optional configuration properties</h2></div></div></div><p>
            There are a number of other properties that control the behavior of NHibernate
            at runtime. All are optional and have reasonable default values.
        </p><div class="table"><a name="configuration-optional-properties"></a><p class="title"><b>Table 2.2. NHibernate Configuration Properties</b></p><table summary="NHibernate Configuration Properties" border="1"><colgroup><col><col></colgroup><thead><tr><th>Property name</th><th>Purpose</th></tr></thead><tbody><tr><td>
                            <code class="literal">hibernate.dialect</code>
                        </td><td>
                            The classname of a NHibernate <code class="literal">Dialect</code> - enables
                            certain platform dependent features.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">full.classname.of.Dialect</code> if a Dialect built into
                                NHibernate, or <code class="literal">full.classname.of.Dialect, assembly</code> 
                                if using an implementation of Dialect not included in NHibernate.
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.default_schema</code>
                        </td><td>
                            Qualify unqualified tablenames with the given schema/tablespace
                            in generated SQL.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">SCHEMA_NAME</code>
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.prepare_sql</code>
                        </td><td>
                            Enables preparing of sql statements. Note that this parameter
                            should not be used in version 1.0.x since prepared statements
                            are currently not remembered and will be re-prepared over and
                            over again.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">true</code> | <code class="literal">false</code>
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.session_factory_name</code>
                        </td><td>
                            The <code class="literal">SessionFactory</code> will be automatically
                            bound to this name after it has been created.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">some.name</code>
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.use_outer_join</code>
                        </td><td>
                            Enables outer join fetching.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">true</code> | <code class="literal">false</code>
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.cache.provider_class</code>
                        </td><td>
                            The classname of a custom <code class="literal">CacheProvider</code>.
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">full.classname.of.CacheProvider</code> if the ICacheProvider is 
                                built into NHibernate, or <code class="literal">full.classname.of.CacheProvider, assembly</code> 
                                if using an implementation of ICacheProvider not included in NHibernate.
                            </p>
                        </td></tr><tr><td>
                            <code class="literal">hibernate.query.substitutions</code>
                        </td><td>
                            Mapping from tokens in NHibernate queries to SQL tokens
                            (tokens might be function or literal names, for example).
                            <p>
                                <span class="strong"><strong>eg.</strong></span> 
                                <code class="literal">hqlLiteral=SQL_LITERAL, hqlFunction=SQLFUNC</code>
                            </p>
                        </td></tr></tbody></table></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-optional-dialects"></a>2.5.1. SQL Dialects</h3></div></div></div><p>
                You should always set the <code class="literal">hibernate.dialect</code> property to the correct
                <code class="literal">NHibernate.Dialect.Dialect</code> subclass for your database. This is not
                strictly essential unless you wish to use <code class="literal">native</code> or
                <code class="literal">sequence</code> primary key generation or pessimistic locking (with, eg.
                <code class="literal">ISession.Lock()</code> or <code class="literal">IQuery.SetLockMode()</code>).
                However, if you specify a dialect, NHibernate will use sensible defaults for some of the
                other properties listed above, saving you the effort of specifying them manually.
            </p><div class="table"><a name="sql-dialects"></a><p class="title"><b>Table 2.3. NHibernate SQL Dialects (<code class="literal">hibernate.dialect</code>)</b></p><table summary="NHibernate SQL Dialects (hibernate.dialect)" border="1"><colgroup><col><col></colgroup><thead><tr><th>RDBMS</th><th>Dialect</th></tr></thead><tbody><tr><td>DB2</td><td><code class="literal">NHibernate.Dialect.DB2Dialect</code></td></tr><tr><td>PostgreSQL</td><td><code class="literal">NHibernate.Dialect.PostgreSQLDialect</code></td></tr><tr><td>MySQL</td><td><code class="literal">NHibernate.Dialect.MySQLDialect</code></td></tr><tr><td>Oracle (any version)</td><td><code class="literal">NHibernate.Dialect.OracleDialect</code></td></tr><tr><td>Oracle 9/10g</td><td><code class="literal">NHibernate.Dialect.Oracle9Dialect</code></td></tr><tr><td>Sybase</td><td><code class="literal">NHibernate.Dialect.SybaseDialect</code></td></tr><tr><td>Microsoft SQL Server 2000</td><td><code class="literal">NHibernate.Dialect.MsSql2000Dialect</code></td></tr><tr><td>Microsoft SQL Server 7</td><td><code class="literal">NHibernate.Dialect.MsSql7Dialect</code></td></tr><tr><td>Firebird</td><td><code class="literal">NHibernate.Dialect.FirebirdDialect</code></td></tr></tbody></table></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-optional-outerjoin"></a>2.5.2. Outer Join Fetching</h3></div></div></div><p>
                If your database supports ANSI or Oracle style outer joins, <span class="emphasis"><em>outer join
                fetching</em></span> might increase performance by limiting the number of round
                trips to and from the database (at the cost of possibly more work performed by
                the database itself). Outer join fetching allows a graph of objects connected
                by many-to-one, one-to-many or one-to-one associations to be retrieved in a single
                SQL <code class="literal">SELECT</code>.
            </p><p>
                By default, the fetched graph when loading an objects ends at leaf objects,
                collections, objects with proxies, or where circularities occur.
            </p><p>
                For a <span class="emphasis"><em>particular  association</em></span>, fetching may be enabled
                or disabled (and the default behaviour overridden) by setting the
                <code class="literal">outer-join</code> attribute in the XML mapping.
            </p><p>
                Outer join fetching may be disabled <span class="emphasis"><em>globally</em></span> by setting
                the property <code class="literal">hibernate.use_outer_join </code> to <code class="literal">false</code>.
                A setting of <code class="literal">true</code> enables outer join fetching for
                all one-to-one and many-to-one associations, which are, also by default, set
                to <code class="literal">auto</code> outer join. However, one-to-many associations and
                collections are never fetched with an outer-join, unless explicitly declared
                for each particular association. This behavior can also be overriden at runtime
                with Hibernate queries.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-optional-cacheprovider"></a>2.5.3. Custom <code class="literal">CacheProvider</code></h3></div></div></div><p>
                You may integrate a second-level cache system by
                implementing the interface <code class="literal">NHibernate.Cache.ICacheProvider</code>.
                You may select the custom implementation by setting
                <code class="literal">hibernate.cache.provider_class</code>.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-optional-querysubstitution"></a>2.5.4. Query Language Substitution</h3></div></div></div><p>
                You may define new Hibernate query tokens using <code class="literal">hibernate.query.substitutions</code>.
                For example:
            </p><pre class="programlisting">hibernate.query.substitutions true=1, false=0</pre><p>
                would cause the tokens <code class="literal">true</code> and <code class="literal">false</code> to be translated to
                integer literals in the generated SQL.
            </p><pre class="programlisting">hibernate.query.substitutions toLowercase=LOWER</pre><p>
                would allow you to rename the SQL <code class="literal">LOWER</code> function.
            </p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-logging"></a>2.6. Logging</h2></div></div></div><p>
            NHibernate logs various events using Apache log4net.
        </p><p>
            You may download log4net from <code class="literal">http://logging.apache.org/log4net/</code>.
            To use log4net you will need a log4net configuration section in the app.config
            or web.config.  An example of the configuration section is distributed with
            NHibernate in the <code class="literal">src/NHibernate.Test</code> project.
        </p><p>
            We strongly recommend that you familiarize yourself with NHibernate's log
            messages. A lot of work has been put into making the NHibernate log as
            detailed as possible, without making it unreadable. It is an essential
            troubleshooting device. 
        </p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="persistent-classes"></a>Chapter 3. Persistent Classes</h2></div></div></div><p>
		Persistent classes are classes in an application that implement the entitites
		of the business problem (ie - Customer and Order in an eCommerce application).
		Persistent classes have, as the name implies, transient and also persistent
		instances stored in the database.
	</p><p>
		NHibernate works best if these classes follow some simple rules, also known
		as the Plain Old CLR Object (POCO) programming model.  
	</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-poco"></a>3.1. A simple POCO example</h2></div></div></div><p>
			A simple example using a class to represent a Cat.
		</p><pre class="programlisting">public class Cat
{
	private long _id; // identifier
	private string _name;
	private DateTime _birthdate;
	private Cat _mate;
	private Set _kittens;
	private Color _color;
	private char _sex;
	private float _weight;

	public long Id
	{
		get { return _id; }
		set { _id = value; }
	}

	public string Name
	{
		get { return _name; }
		set { _name = value; }
	}

	public DateTime Birthdate
	{
		get { return _birthdate; }
		set { _birthdate = value; }
	}

	public Cat Mate
	{
		get { return _mate; }
		set { _mate = value; }
	}

	public Set Kittens
	{
		get { return _kittens; }
		set { _kittens = value; }
	}

	public Color Color
	{
		get { return _color; }
		set { _color = value; }
	}

	public char Sex
	{
		get { return _sex; }
		set { _sex = value; }
	}

	public float Weight
	{
		get { return _weight; }
		set { _weight = value; }
	}

}
</pre><p>
			There are four main rules to follow here:
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="persistent-classes-poco-accessors"></a>3.1.1. Declare getters and setters for persistent fields (optional)</h3></div></div></div><p>
				<code class="literal">Cat</code> declares property getters and setters for all its persistent fields.
				It is good practice to use getters and setters instead of direct access to fields.  However,
				it is possible to use NHibernate with fields instead of properties.
			</p><p>
				Properties do <span class="emphasis"><em>not</em></span> need to be declared as public - NHibernate can
				persist a property with a default, <code class="literal">procted</code>, <code class="literal">internal</code>,
				or <code class="literal">private</code> visibility.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="persistent-classes-poco-constructor"></a>3.1.2. Implement a default constructor</h3></div></div></div><p>
				<code class="literal">Cat</code> has an implicit default (no argument) constructor.  All
				persistent classes must have a default construction (which may be non-public) so
				NHibernate can instantiate them using <code class="literal">Constructor.Invoke()</code>.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="persistent-classes-poco-identifier"></a>3.1.3. Provide an identifier property (optional)</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="persistent-classes-poco-sealed"></a>3.1.4. Prefer non-sealed classes (optional)</h3></div></div></div><p></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-inheritance"></a>3.2. Implementing inheritence</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-equalshashcode"></a>3.3. Implementing <code class="literal">Equals()</code> and <code class="literal">GetHashCode()</code></h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-lifecycle"></a>3.4. Lifecycle Callbacks</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-validatable"></a>3.5. Validatable callback</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-classes-attribute"></a>3.6. Using Attributes instead of XML</h2></div></div></div><p></p></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="part-mapping"></a>Part I. NHibernate Mapping</h1></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="basic-mapping"></a>Chapter 4. Basic O/R Mapping</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-declaration"></a>4.1. Mapping declaration</h2></div></div></div><p>
			Object/relational mappings are defined in an XML document. The mapping document
			is designed to be readable and hand-editable. The mapping language is .NET-centric,
			meaning that mappings are constructed around persistent class declarations, not
			table declarations.
		</p><p>
			Note that, even though many Hibernate users choose to define XML mappings be hand,
			a number of tools exist to generate the mapping document, including XDoclet,
			Middlegen and AndroMDA.
		</p><p>
			Lets kick off with an example mapping:
		</p><pre class="programlisting">
&lt;?xml version="1.0" ?&gt;
&lt;hibernate-mapping xmlns="urn:nhibernate-mapping-2.0"
	namespace="Eg" assembly="Eg"&gt;

	&lt;class name="Cat" table="CATS" discriminator-value="C"&gt;
		&lt;id name="Id" column="uid" type="Int64"&gt;
			&lt;generator class="hilo"/&gt;
		&lt;/id&gt;
		&lt;discriminator column="subclass" type="Char"/&gt;
		&lt;property name="Birthdate" type="Date"/&gt;
		&lt;property name="Color" not-null="true"/&gt;
		&lt;property name="Sex" not-null="true" update="false"/&gt;
		&lt;property name="Weight"/&gt;
		&lt;many-to-one name="Mate" column="mate_id"/&gt;
		&lt;set name="Kittens"&gt;
			&lt;key column="mother_id"/&gt;
			&lt;one-to-many class="Cat"/&gt;
		&lt;/set&gt;
		&lt;subclass name="DomesticCat" discriminator-value="D"&gt;
			&lt;property name="Name" type="String"/&gt;
		&lt;/subclass&gt;
	&lt;/class&gt;

	&lt;class name="Dog"&gt;
		&lt;!-- mapping for Dog could go here --&gt;
	&lt;/class&gt;

&lt;/hibernate-mapping&gt;
</pre><p>
				We will now discuss the content of the mapping document. We will only describe the 
				document elements and attributes that are used by Hibernate at runtime. The mapping 
				document also contains some extra optional attributes and elements that affect the 
				database schemas exported by the schema export tool. (For example the <code class="literal">
				not-null</code> attribute.)
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-doctype"></a>4.1.1. Schema</h3></div></div></div><p>
				All XML mappings have to use the nhibernate-mapping-2.0 schema. The actual schema may be found 
				in the NHibernate source directory, or as an Embedded Resource in <code class="literal">NHibernate.dll</code>. 
				NHibernate will always use the Embedded Resource as the source for the schema.
			</p><p>
				To get intellisense while working with the <code class="literal">hibernate-mapping</code> xml inside of VisualStudio.NET 
				you should copy the schema to the folder 
				<code class="literal">C:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Packages\schemas\xml</code>
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-mapping"></a>4.1.2. hibernate-mapping</h3></div></div></div><p>
				This element has four optional attributes. The <code class="literal">schema</code> attribute
				specifies that tables referred to by this mapping belong to the named schema. If specified, 
				tablenames will be qualified by the given schema name. If missing, tablenames will be 
				unqualified. The <code class="literal">default-cascade</code> attribute specifies what cascade style
				should be assumed for properties and collections which do not specify a 
				<code class="literal">cascade</code> attribute. The <code class="literal">auto-import</code> attribute lets us
				use unqualified class names in the query language, by default.  The <code class="literal">default-access</code>
				attribute tells us how to access property values.
			</p><pre class="programlisting">&lt;hibernate-mapping
	schema="schemaName" <a name="hm1-co" href="#hm1">(1)</a>
	default-cascade="none|save-update" <a name="hm2-co" href="#hm2">(2)</a>
	auto-import="true|false" <a name="hm3-co" href="#hm3">(3)</a>
	default-access="property|field|nosetter|ClassName" <a name="hm4-co" href="#hm4">(4)</a>
	assembly="assembly.name" <a name="hm5-co" href="#hm5">(5)</a>
	namespace="namespace.name" <a name="hm6-co" href="#hm6">(6)</a>
&gt; </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="hm1"></a><a href="#hm1-co">(1)</a> </td><td valign="top" align="left"><p>
							<code class="literal">schema</code> (optional): The name of a database schema.
						</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="hm2"></a><a href="#hm2-co">(2)</a> </td><td valign="top" align="left"><p>
							<code class="literal">default-cascade</code> (optional - defaults to <code class="literal">none</code>): 
							A default cascade style.
						</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="hm3"></a><a href="#hm3-co">(3)</a> </td><td valign="top" align="left"><p>
							<code class="literal">auto-import</code> (optional - defaults to <code class="literal">true</code>):
							Specifies whether we can use unqualified class names (of classes in this mapping)
							in the query language.
						</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="hm4"></a><a href="#hm4-co">(4)</a> </td><td valign="top" align="left"><p>
							<code class="literal">default-access</code> (optional - defaults to <code class="literal">property</code>):
							The strategy NHibernate should use for accessing the property value.
						</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="hm5"></a><a href="#hm5-co">(5)</a> </td><td valign="top" align="left"><p>
							<code class="literal">assembly</code> (optional):
							Specifies an Assembly to assume for any class names that don't have the
							Assembly specified.
						</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="hm6"></a><a href="#hm6-co">(6)</a> </td><td valign="top" align="left"><p>
							<code class="literal">namespace</code> (optional):  Specifies a namespace prefix 
							to assume for unqualified class names in the mapping document.
						</p></td></tr></table></div><p>
				If you have two persistent classes with the same (unqualified) name, you should set 
				<code class="literal">auto-import="false"</code>. NHibernate will throw an exception if you attempt
				to assign two classes to the same "imported" name.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-class"></a>4.1.3. class</h3></div></div></div><p>
				You may declare a persistent class using the <code class="literal">class</code> element:
			</p><pre class="programlisting">&lt;class
	name="ClassName" <a name="class1-co" href="#class1">(1)</a>
	table="tableName"<a name="class2-co" href="#class2">(2)</a>
	discriminator-value="discriminator_value"<a name="class3-co" href="#class3">(3)</a>
	mutable="true|false"<a name="class4-co" href="#class4">(4)</a>
	schema="owner"<a name="class5-co" href="#class5">(5)</a>
	proxy="ProxyInterface"<a name="class6-co" href="#class6">(6)</a>
	dynamic-update="true|false"<a name="class7-co" href="#class7">(7)</a>
	dynamic-insert="true|false"<a name="class8-co" href="#class8">(8)</a>
	polymorphism="implicit|explicit"<a name="class9-co" href="#class9">(9)</a>
	where="arbitrary sql where condition"<a name="class10-co" href="#class10">(10)</a>
	persister="PersisterClass"<a name="class11-co" href="#class11">(11)</a>
	lazy="true|false"<a name="class12-co" href="#class12">(12)</a>
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="class1"></a><a href="#class1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code>: The fully qualified .NET Type name of the persistent class 
						(or interface).
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class2"></a><a href="#class2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">table</code>: The name of its database table.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class3"></a><a href="#class3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">discriminator-value</code> (optional - defaults to the class name): A value
						that distiguishes individual subclasses, used for polymorphic behaviour.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class4"></a><a href="#class4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">mutable</code> (optional, defaults to <code class="literal">true</code>): Specifies 
						that instances of the class are (not) mutable.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class5"></a><a href="#class5-co">(5)</a> </td><td valign="top" align="left"><p>
						<code class="literal">schema</code> (optional): Override the schema name specified by
						the root <code class="literal">&lt;hibernate-mapping&gt;</code> element.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class6"></a><a href="#class6-co">(6)</a> </td><td valign="top" align="left"><p>
						<code class="literal">proxy</code> (optional): Specifies an interface to use for lazy
						initializing proxies. You may specify the name of the class itself as long as 
						all Properties are virtual.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class7"></a><a href="#class7-co">(7)</a> </td><td valign="top" align="left"><p>
						<code class="literal">dynamic-update</code> (optional, defaults to <code class="literal">false</code>): 
						Specifies that <code class="literal">UPDATE</code> SQL should be generated at runtime and 
						contain only those columns whose values have changed.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class8"></a><a href="#class8-co">(8)</a> </td><td valign="top" align="left"><p>
						<code class="literal">dynamic-insert</code> (optional, defaults to <code class="literal">false</code>): 
						Specifies that <code class="literal">INSERT</code> SQL should be generated at runtime and 
						contain only the columns whose values are not null.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class9"></a><a href="#class9-co">(9)</a> </td><td valign="top" align="left"><p>
						<code class="literal">polymorphism</code> (optional, defaults to <code class="literal">implicit</code>): 
						Determines whether implicit or explicit query polymorphism is used.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class10"></a><a href="#class10-co">(10)</a> </td><td valign="top" align="left"><p>
						<code class="literal">where</code> (optional) specify an arbitrary SQL <code class="literal">WHERE</code> 
						condition to be used when retrieving objects of this class
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class11"></a><a href="#class11-co">(11)</a> </td><td valign="top" align="left"><p>
						<code class="literal">persister</code> (optional): Specifies a custom <code class="literal">IClassPersister</code>.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="class12"></a><a href="#class12-co">(12)</a> </td><td valign="top" align="left"><p>
						<code class="literal">lazy</code>(optional): Setting <code class="literal">lazy="true"</code> is a shortcut 
						equalivalent to specifying the name of the class itself as the <code class="literal">proxy</code>
						interface.
					</p></td></tr></table></div><p>
				It is perfectly acceptable for the named persistent class to be an interface. You would then
				declare implementing classes of that interface using the <code class="literal">&lt;subclass&gt;</code>
				element. You may persist any inner class. You should specify the
				class name using the standard form ie. <code class="literal">Eg.Foo+Bar</code>.
			</p><p>
				Immutable classes, <code class="literal">mutable="false"</code>, may not be updated or deleted by the 
				application. This allows NHibernate to make some minor performance optimizations.
			</p><p>
				The optional <code class="literal">proxy</code> attribute enables lazy initialization of persistent
				instances of the class. NHibernate will initially return proxies generated by Castle.DynamicProxy
				which implement the named interface or extend the class. The actual persistent object will be 
				loaded when a method of the proxy is invoked. See "Proxies for Lazy Initialization" below.
			</p><p><span class="emphasis"><em>Implicit</em></span> polymorphism means that instances of the class will be returned
				by a query that names any superclass or implemented interface or the class and that instances
				of any subclass of the class will be returned by a query that names the class itself. 
				<span class="emphasis"><em>Explicit</em></span> polymorphism means that class instances will be returned only
				be queries that explicitly name that class and that queries that name the class will return
				only instances of subclasses mapped inside this <code class="literal">&lt;class&gt;</code> declaration
				as a <code class="literal">&lt;subclass&gt;</code> or <code class="literal">&lt;joined-subclass&gt;</code>. For
				most purposes the default, <code class="literal">polymorphism="implicit"</code>, is appropriate.
				Explicit polymorphism is useful when two different classes are mapped to the same table
				(this allows a "lightweight" class that contains a subset of the table columns).
			</p><p>
				The <code class="literal">persister</code> attribute lets you customize the persistence strategy used for
				the class. You may, for example, specify your own subclass of 
				<code class="literal">NHibernate.Persister.EntityPersister</code> or you might even provide a
				completely new implementation of the interface 
				<code class="literal">NHibernate.Persister.IClassPersister</code> that implements persistence via,
				for example, stored procedure calls, serialization to flat files or LDAP. See
				<code class="literal">NHibernate.DomainModel.CustomPersister</code> for a simple example (of "persistence"
				to a <code class="literal">Hashtable</code>).
			</p><p>
				Note that the <code class="literal">dynamic-update</code> and <code class="literal">dynamic-insert</code>
				settings are not inherited by subclasses and so may also be specified on the
				<code class="literal">&lt;subclass&gt;</code> or <code class="literal">&lt;joined-subclass&gt;</code> elements. 
				These settings may increase performance in some cases, but might actually decrease 
				performance in others. Use judiciously.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration_id"></a>4.1.4. id</h3></div></div></div><p>
				Mapped classes <span class="emphasis"><em>must</em></span> declare the primary key column of the database 
				table. Most classes will also have a Property holding the unique identifier 
				of an instance. The <code class="literal">&lt;id&gt;</code> element defines the mapping from that
				property to the primary key column.
			</p><pre class="programlisting">&lt;id 
	name="propertyName" <a name="id1-co" href="#id1">(1)</a>
	type="typename" <a name="id2-co" href="#id2">(2)</a>
	column="column_name" <a name="id3-co" href="#id3">(3)</a>
	unsaved-value="any|none|null|id_value" <a name="id4-co" href="#id4">(4)</a>
	access="field|property|nosetter|ClassName"&gt; <a name="id5-co" href="#id5">(5)</a>

	&lt;generator class="generatorClass"/&gt;
&lt;/id&gt;		</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="id1"></a><a href="#id1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code> (optional): The name of the identifier property.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="id2"></a><a href="#id2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">type</code> (optional): A name that indicates the NHibernate type.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="id3"></a><a href="#id3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional - defaults to the property name): The
						name of the primary key column.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="id4"></a><a href="#id4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">unsaved-value</code> (optional - defaults to a "sensible" value): 
						An identifier property value that indicates that an instance is newly instantiated
						(unsaved), distinguishing it from detached instances that were saved or loaded
						in a previous session.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="id5"></a><a href="#id5-co">(5)</a> </td><td valign="top" align="left"><p>
						<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
						strategy NHibernate should use for accessing the property value.
					</p></td></tr></table></div><p>
				If the <code class="literal">name</code> attribute is missing, it is assumed that the class has no 
				identifier property.
			</p><p>
				The <code class="literal">unsaved-value</code> attribute is almost never needed in NHibernate 1.0.
			</p><p>
				There is an alternative <code class="literal">&lt;composite-id&gt;</code> declaration to allow access to
				legacy data with composite keys. We strongly discourage its use for anything else.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-generator"></a>4.1.4.1. generator</h4></div></div></div><p>
					The required <code class="literal">&lt;generator&gt;</code> child element names a .NET type used
					to generate unique identifiers for instances of the persistent class. If any parameters
					are required to configure or initialize the generator instance, they are passed using the
					<code class="literal">&lt;param&gt;</code> element.
				</p><pre class="programlisting">&lt;id name="Id" type="Int64" column="uid" unsaved-value="0"&gt;
	&lt;generator class="NHibernate.Id.TableHiLoGenerator"&gt;
		&lt;param name="table"&gt;uid_table&lt;/param&gt;
		&lt;param name="column"&gt;next_hi_value_column&lt;/param&gt;
	&lt;/generator&gt;
&lt;/id&gt;</pre><p>
					All generators implement the interface <code class="literal">NHibernate.Id.IdentifierGenerator</code>.
					This is a very simple interface; some applications may choose to provide their own specialized
					implementations. However, NHibernate provides a range of built-in implementations. There are shortcut
					names for the built-in generators:
	                
					</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">identity</code></span></dt><dd><p>
								supports identity columns in DB2, MySQL, MS SQL Server, Sybase and
								HypersonicSQL. The returned identifier is of type <code class="literal">Int64</code>,
								<code class="literal">Int32</code> or <code class="literal">Int16</code>.
							</p></dd><dt><span class="term"><code class="literal">sequence</code></span></dt><dd><p>
								uses a sequence in DB2, PostgreSQL, Oracle. The returned identifier 
								is of type <code class="literal">Int64</code>,
								<code class="literal">Int32</code> or <code class="literal">Int16</code>
							</p></dd><dt><span class="term"><code class="literal">hilo</code></span></dt><dd><p>
								uses a hi/lo algorithm to efficiently generate identifiers of
								type <code class="literal">Int64</code>, <code class="literal">Int32</code> or <code class="literal">Int16</code>,
								given a table and column (by default <code class="literal">hibernate_unique_key</code> and
								<code class="literal">next</code> respectively) as a source of hi values. The hi/lo algorithm
								generates identifiers that are unique only for a particular database.
							</p></dd><dt><span class="term"><code class="literal">seqhilo</code></span></dt><dd><p>
								uses a hi/lo algorithm to efficiently generate identifiers of type
								<code class="literal">Int64</code>, <code class="literal">Int32</code> or <code class="literal">Int16</code>,
								given a named database sequence.
							</p></dd><dt><span class="term"><code class="literal">uuid.hex</code></span></dt><dd><p>
								uses <code class="literal">System.Guid</code> and its <code class="literal">ToString(string format)</code> method
								to generate identifiers of type string.  The length of the string returned depends on the 
								configured <code class="literal">format</code>.
							</p></dd><dt><span class="term"><code class="literal">uuid.string</code></span></dt><dd><p>
								uses a new <code class="literal">System.Guid</code> to create a <code class="literal">byte[]</code> that is
								converted to a string.
							</p></dd><dt><span class="term"><code class="literal">guid</code></span></dt><dd><p>
								uses a new <code class="literal">System.Guid</code> as the identifier.
							</p></dd><dt><span class="term"><code class="literal">guid.comb</code></span></dt><dd><p>
								uses the algorithm to generate a new <code class="literal">System.Guid</code>
								described by Jimmy Nilsson in the article 
								http://www.informit.com/articles/article.asp?p=25862.
							</p></dd><dt><span class="term"><code class="literal">native</code></span></dt><dd><p>
								picks <code class="literal">identity</code>, <code class="literal">sequence</code> or
								<code class="literal">hilo</code> depending upon the capabilities of the
								underlying database.
							</p></dd><dt><span class="term"><code class="literal">assigned</code></span></dt><dd><p>
								lets the application to assign an identifier to the object before
								<code class="literal">save()</code> is called.
							</p></dd><dt><span class="term"><code class="literal">foreign</code></span></dt><dd><p>
								uses the identifier of another associated object. Usually used in conjunction
								with a <code class="literal">&lt;one-to-one&gt;</code> primary key association.
							</p></dd></dl></div><p>

				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-hilo"></a>4.1.4.2. Hi/Lo Algorithm</h4></div></div></div><p>
					The <code class="literal">hilo</code> and <code class="literal">seqhilo</code> generators provide two alternate
					implementations of the hi/lo algorithm, a favorite approach to identifier generation. The
					first implementation requires a "special" database table to hold the next available "hi" value.
					The second uses an Oracle-style sequence (where supported).
				</p><pre class="programlisting">&lt;id name="Id" type="Int64" column="cat_id"&gt;
	&lt;generator class="hilo"&gt;
		&lt;param name="table"&gt;hi_value&lt;/param&gt;
		&lt;param name="column"&gt;next_value&lt;/param&gt;
		&lt;param name="max_lo"&gt;100&lt;/param&gt;
	&lt;/generator&gt;
&lt;/id&gt;</pre><pre class="programlisting">&lt;id name="Id" type="Int64" column="cat_id"&gt;
	&lt;generator class="seqhilo"&gt;
		&lt;param name="sequence"&gt;hi_value&lt;/param&gt;
		&lt;param name="max_lo"&gt;100&lt;/param&gt;
	&lt;/generator&gt;
&lt;/id&gt;</pre><p>
					Unfortunately, you can't use <code class="literal">hilo</code> when supplying your own
					<code class="literal">Connection</code>  to NHibernate. NHibernate must be able to
					fetch the "hi" value in a new transaction.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-uuid-hex"></a>4.1.4.3. UUID Hex Algorithm</h4></div></div></div><pre class="programlisting">&lt;id name="Id" type="String" column="cat_id"&gt;
	&lt;generator class="uuid.hex"&gt;
		&lt;param name="format"&gt;format_value&lt;/param&gt;
		&lt;param name="seperator"&gt;seperator_value&lt;/param&gt;
	&lt;/generator&gt;
&lt;/id&gt;</pre><p>
					The UUID is generated by calling <code class="literal">Guid.NewGuid().ToString(format)</code>.  The
					valid values for format are described in the MSDN documentation.  The default 
					<code class="literal">seperator</code> is <code class="literal">-</code> and should rarely be modified.  The
					<code class="literal">format</code> determines if the configured <code class="literal">seperator</code> can 
					replace the default seperator used by the <code class="literal">format</code>.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-uuid-string"></a>4.1.4.4. UUID String Algorithm</h4></div></div></div><p>
					The UUID is generated by calling <code class="literal">Guid.NewGuid().ToByteArray()</code> and 
					then converting the <code class="literal">byte[]</code> into a <code class="literal">char[]</code>.  The
					<code class="literal">char[]</code> is returned as a <code class="literal">String</code> consisting of
					16 characters.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-guid"></a>4.1.4.5. GUID Algorithms</h4></div></div></div><p>
					The <code class="literal">guid</code> identifier is generated by calling <code class="literal">Guid.NewGuid()</code>.
					To address some of the performance concerns with using Guids as primary keys, foreign keys, and
					as part of indexes with MS SQL the <code class="literal">guid.comb</code> can be used.  The benefit of using  
					the <code class="literal">guid.comb</code> with other databases that support GUIDs has not been measured.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-sequences"></a>4.1.4.6. Identity columns and Sequences</h4></div></div></div><p>
					For databases which support identity columns (DB2, MySQL, Sybase, MS SQL), you
					may use <code class="literal">identity</code> key generation. For databases that support
					sequences (DB2, Oracle, PostgreSQL) you may use
					<code class="literal">sequence</code> style key generation. Both these strategies usually require
					two SQL queries to insert a new object.  When working with MS SQL and the 
					<code class="literal">identity</code> key generator then <code class="literal">select SCOPE_IDENTITY()</code>
					will be appended to the <code class="literal">insert</code> sql thus avoiding the executions
					of a two distinct <code class="literal">IDbCommand</code>s.
				</p><pre class="programlisting">&lt;id name="Id" type="Int64" column="uid"&gt;
	&lt;generator class="sequence"&gt;
			&lt;param name="sequence"&gt;uid_sequence&lt;/param&gt;
	&lt;/generator&gt;
&lt;/id&gt;</pre><pre class="programlisting">&lt;id name="Id" type="Int64" column="uid" unsaved-value="0"&gt;
	&lt;generator class="identity"/&gt;
&lt;/id&gt;</pre><p>
					For cross-platform development, the <code class="literal">native</code> strategy will
					choose from the <code class="literal">identity</code>, <code class="literal">sequence</code> and
					<code class="literal">hilo</code> strategies, dependant upon the capabilities of the
					underlying database.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mapping-declaration-id-assigned"></a>4.1.4.7. Assigned Identifiers</h4></div></div></div><p>
					If you want the application to assign identifiers (as opposed to having
					NHibernate generate them), you may use the <code class="literal">assigned</code> generator.
					This special generator will use the identifier value already assigned to the
					object's identifier property. Be very careful when using this feature to not assign
					keys with business meaning (almost always a terrible design decision).
				</p><p>
					Due to its inherent nature, entities that use this generator cannot be saved
					via the ISession's <code class="literal">SaveOrUpdate()</code> method. Instead you have to 
					explicitly specify to NHibernate if the object should be saved or updated 
					by calling either the <code class="literal">Save()</code> or <code class="literal">Update()</code> 
					method of the ISession.
				</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-compositeid"></a>4.1.5. composite-id</h3></div></div></div><pre class="programlisting">&lt;composite-id
	name="propertyName"<a name="composite-id1-co" href="#composite-id1">(1)</a>
	class="ClassName"<a name="composite-id2-co" href="#composite-id2">(2)</a>
	unsaved-value="any|none"<a name="composite-id3-co" href="#composite-id3">(3)</a>
	access="field|property|nosetter|ClassName"&gt;

	&lt;key-property name="propertyName" type="typename" column="column_name"/&gt;
	&lt;key-many-to-one name="propertyName class="ClassName" column="column_name"/&gt;
	......
&lt;/composite-id&gt;</pre><p>
				For a table with a composite key, you may map multiple properties of the class
				as identifier properties. The <code class="literal">&lt;composite-id&gt;</code> element
				accepts <code class="literal">&lt;key-property&gt;</code> property mappings and
				<code class="literal">&lt;key-many-to-one&gt;</code> mappings as child elements.
			</p><pre class="programlisting">&lt;composite-id&gt;
	&lt;key-property name="medicareNumber"/&gt;
	&lt;key-property name="dependent"/&gt;
&lt;/composite-id&gt;</pre><p>
				Your persistent class <span class="emphasis"><em>must</em></span> override <code class="literal">Equals()</code>
				and <code class="literal">GetHashCode()</code> to implement composite identifier equality. It must
				also be <code class="literal">Serializable</code>.
			</p><p>
				Unfortunately, this approach to composite identifiers means that a persistent object 
				is its own identifier. There is no convenient "handle" other than the object itself. 
				You must instantiate an instance of the persistent class itself and populate its 
				identifier properties before you can <code class="literal">Load()</code> the persistent state
				associated with a composite key. We will describe a much more
				convenient approach where the composite identifier is implemented as a seperate class
				in TODO:LINKTOCOMPENENTS. The attributes described below apply only
				to this alternative approach:
			</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="composite-id1"></a><a href="#composite-id1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code> (optional): A property of component type that holds the
						composite identifier (see next section).
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="composite-id2"></a><a href="#composite-id2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">class</code> (optional - defaults to the property type determined by 
						reflection): The component class used as a composite identifier (see next section).
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="composite-id3"></a><a href="#composite-id3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">unsaved-value</code> (optional - defaults to <code class="literal">none</code>): 
						Indicates that transient instances should be considered newly instantiated, if set 
						to <code class="literal">any</code>.
					</p></td></tr></table></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-discriminator"></a>4.1.6. discriminator</h3></div></div></div><p>
				The <code class="literal">&lt;discriminator&gt;</code> element is required for polymorphic persistence 
				using the table-per-class-hierarchy mapping strategy and declares a discriminator column of the 
				table. The discriminator column contains marker values that tell the persistence layer what 
				subclass to instantiate for a particular row. A restricted set of types may be used: 
				<code class="literal">String</code>, <code class="literal">Char</code>, <code class="literal">Int32</code>, 
				<code class="literal">Byte</code>, <code class="literal">Int16</code>, <code class="literal">Boolean</code>, 
				<code class="literal">YesNo</code>, <code class="literal">TrueFalse</code>.
			</p><pre class="programlisting">&lt;discriminator
	column="discriminator_column"<a name="discriminator1-co" href="#discriminator1">(1)</a>
	type="discriminator_type"<a name="discriminator2-co" href="#discriminator2">(2)</a>
	force="true|false"<a name="discriminator3-co" href="#discriminator3">(3)</a>
	insert="true|false" <a name="discriminator4-co" href="#discriminator4">(4)</a>
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="discriminator1"></a><a href="#discriminator1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional - defaults to <code class="literal">class</code>) the
						name of the discriminator column.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="discriminator2"></a><a href="#discriminator2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">type</code> (optional - defaults to <code class="literal">String</code>) a
						name that indicates the Hibernate type
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="discriminator3"></a><a href="#discriminator3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">force</code> (optional - defaults to <code class="literal">false</code>) 
						"force" NHibernate to specify allowed discriminator values even when retrieving 
						all instances of the root class.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="discriminator4"></a><a href="#discriminator4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">insert</code> (optional - defaults to <code class="literal">true</code>) 
						set this to <code class="literal">false</code> if your discriminator column is also part
						of a mapped composite identifier.
					</p></td></tr></table></div><p>
				Actual values of the discriminator column are specified by the
				<code class="literal">discriminator-value</code> attribute of the <code class="literal">&lt;class&gt;</code> and
				<code class="literal">&lt;subclass&gt;</code> elements.
			</p><p>
				The <code class="literal">force</code> attribute is (only) useful if the table contains rows with
				"extra" discriminator values that are not mapped to a persistent class. This will not
				usually be the case.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-version"></a>4.1.7. version (optional)</h3></div></div></div><p>
				The <code class="literal">&lt;version&gt;</code> element is optional and indicates that
				the table contains versioned data. This is particularly useful if you plan to
				use <span class="emphasis"><em>long transactions</em></span> (see below).
			</p><pre class="programlisting">&lt;version
	column="version_column"<a name="version1-co" href="#version1">(1)</a>
	name="propertyName"<a name="version2-co" href="#version2">(2)</a>
	type="typename"<a name="version3-co" href="#version3">(3)</a>
	access="field|property|nosetter|ClassName"<a name="version4-co" href="#version4">(4)</a>
	unsaved-value="null|negative|undefined|value"<a name="version5-co" href="#version5">(5)</a>
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="version1"></a><a href="#version1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional - defaults to the property name): The name
						of the column holding the version number.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="version2"></a><a href="#version2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code>: The name of a property  of the persistent class.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="version3"></a><a href="#version3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">type</code> (optional - defaults to <code class="literal">Int32</code>): 
						The type of the version number.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="version4"></a><a href="#version4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
						strategy NHibernate should use for accessing the property value.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="version5"></a><a href="#version5-co">(5)</a> </td><td valign="top" align="left"><p>
						<code class="literal">unsaved-value</code> (optional - defaults to <code class="literal">undefined</code>):
						A version property value that indicates that an instance is newly instantiated
						(unsaved), distinguishing it from transient instances that were saved or loaded
						in a previous session.  (<code class="literal">undefined</code> specifies that the identifier
						property value should be used.)
					</p></td></tr></table></div><p>
				Version numbers may be of type <code class="literal">Int64</code>, <code class="literal">Int32</code>,
				<code class="literal">Int16</code>, <code class="literal">Ticks</code>, <code class="literal">Timestamp</code>, 
				or <code class="literal">TimeSpan</code>.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-timestamp"></a>4.1.8. timestamp (optional)</h3></div></div></div><p>
				The optional <code class="literal">&lt;timestamp&gt;</code> element indicates that the table contains 
				timestamped data. This is intended as an alternative to versioning. Timestamps are by nature
				a less safe implementation of optimistic locking. However, sometimes the application might
				use the timestamps in other ways.
			</p><pre class="programlisting">&lt;timestamp
	column="timestamp_column"<a name="timestamp1-co" href="#timestamp1">(1)</a>
	name="propertyName"<a name="timestamp2-co" href="#timestamp2">(2)</a>
	access="field|property|nosetter|ClassName"<a name="timestamp3-co" href="#timestamp3">(3)</a>
	unsaved-value="null|negative|undefined|value"<a name="timestamp4-co" href="#timestamp4">(4)</a>
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="timestamp1"></a><a href="#timestamp1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional - defaults to the property name): The name
						of a column holding the timestamp.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="timestamp2"></a><a href="#timestamp2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code>: The name of a property of .NET type <code class="literal">DateTime</code>.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="timestamp3"></a><a href="#timestamp3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
						strategy NHibernate should use for accessing the property value.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="timestamp4"></a><a href="#timestamp4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">unsaved-value</code> (optional - defaults to <code class="literal">undefined</code>):
						A timestamp property value that indicates that an instance is newly instantiated
						(unsaved), distinguishing it from transient instances that were saved or loaded
						in a previous session.  (<code class="literal">undefined</code> specifies that the identifier
						property value should be used.)
					</p></td></tr></table></div><p>
				Note that <code class="literal">&lt;timestamp&gt;</code> is equivalent to 
				<code class="literal">&lt;version type="timestamp"&gt;</code>.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-property"></a>4.1.9. property</h3></div></div></div><p>
				The <code class="literal">&lt;property&gt;</code> element declares a persistent, 
				property of the class.
			</p><pre class="programlisting">&lt;property
	name="propertyName"<a name="property1-co" href="#property1">(1)</a>
	column="column_name"<a name="property2-co" href="#property2">(2)</a>
	type="typename"<a name="property3-co" href="#property3">(3)</a>
	update="true|false"<a name="property4-co" href="#property4">(4)</a>
	insert="true|false"<a name="property5-co" href="#property5">(5)</a>
	formula="arbitrary SQL expression"<a name="property6-co" href="#property6">(6)</a>
	access="field|property|nosetter|ClassName"<a name="property7-co" href="#property7">(7)</a>
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="property1"></a><a href="#property1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code>: the name of the property in the same case as the Propery in your API
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property2"></a><a href="#property2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional - defaults to the property name): the name
						of the mapped database table column.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property3"></a><a href="#property3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">type</code> (optional): a name that indicates the NHibernate type.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property4"></a><a href="#property4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">update</code> (optional - defaults to <code class="literal">true</code>) :
						specifies that the mapped columns should be included in SQL <code class="literal">UPDATE</code> 
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property5"></a><a href="#property5-co">(5)</a> </td><td valign="top" align="left"><p>
						<code class="literal">insert</code> (optional - defaults to <code class="literal">true</code>) :
						specifies that the mapped columns should be included in SQL 
						<code class="literal">INSERT</code> statements. Setting both <code class="literal">insert</code>
						and <code class="literal">update</code> to <code class="literal">false</code>
						allows a pure "derived" property whose value is initialized from some other
						property that maps to the same colum(s) or by a trigger or other application.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property6"></a><a href="#property6-co">(6)</a> </td><td valign="top" align="left"><p>
						<code class="literal">formula</code> (optional): an SQL expression that defines the value for a
						<span class="emphasis"><em>computed</em></span> property. Computed properties do not have a column
						mapping of their own.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="property7"></a><a href="#property7-co">(7)</a> </td><td valign="top" align="left"><p>
						<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
						strategy NHibernate should use for accessing the property value.
					</p></td></tr></table></div><p>
				<span class="emphasis"><em>typename</em></span> could be:
			</p><div class="orderedlist"><ol type="1" compact><li><p>
						The name of a NHibernate basic type (eg. <code class="literal">Int32, String, Char,
						DateTime, Timstamp, Single, Byte[], Object, ...</code>).
					</p></li><li><p>
						The name of a .NET type with a default basic type (eg. <code class="literal">System.Int16, System.Single,
						System.Char, System.String, System.DateTime, System.Byte[], ...</code>).
					</p></li><li><p>
						The name of a your of <code class="literal">System.Enum </code> (eg. <code class="literal">Eg.Color</code>).
					</p></li><li><p>
						The name of a serializable .NET type.
					</p></li><li><p>
						The type of a custom type (eg. <code class="literal">Illflow.Type.MyCustomType, Illflow</code>).
					</p></li></ol></div><p>
				If you do not specify a type, NHibernate will use reflection upon the named
				property to take a guess at the correct NHibernate type. NHibernate will try to
				interpret the name of the return class of the property getter using rules 2, 3,
				4 in that order. However, this is not always enough.
				In certain cases you will still need the <code class="literal">type</code>
				attribute. (For example, to distinguish between <code class="literal">NHibernate.DateTime</code> and
				<code class="literal">NHibernate.Timestamp</code>, or to specify a custom type.)
			</p><p>
				The <code class="literal">access</code> attribute lets you control how NHibernate will access
				the value of the property at runtime.  The value of the <code class="literal">access</code> attribute should
				be text formatted as <code class="literal">access-strategy.naming-strategy</code>.  The 
				<code class="literal">.naming-stragey</code> is not always required.
				</p><div class="table"><a name="id410103"></a><p class="title"><b>Table 4.1. Access Strategy</b></p><table summary="Access Strategy" border="1"><colgroup><col><col></colgroup><thead><tr><th>Access Strategy Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">property</code></td><td>
									<p>
										The default implementation.  NHibernate uses the get/set of your Property.  No
										Naming Strategy should be used with this Access Strategy because the 
										<code class="literal">name</code> attribute is the name of the Property.
									</p>
								</td></tr><tr><td><code class="literal">field</code></td><td>
									<p>
										NHibernate will access the Field directly.  NHibernate uses the <code class="literal">&lt;name&gt;</code>
										as the name of the field.  This can be used when a Property's get and set have extra
										actions in them that you don't want to occur when NHibernate is populating or reading the object.  
										If you want the name of the Property and not the Field to be what the consumers of your API 
										use with HQL, then a Naming Strategy is needed.
									</p>
								</td></tr><tr><td><code class="literal">nosetter</code></td><td>
									<p>
										NHibernate will access the Field directly when setting the value and will use the
										Property when getting the value.  This can be used when a Property only exposes a get because
										the consumers of your API can't change the value directly.  A Naming Strategy is required
										because NHibernate uses the <code class="literal">name</code> attribute as the Property so it needs to 
										be told what the name of the Field is.
									</p>
								</td></tr><tr><td><code class="literal">ClassName</code></td><td>
									<p>
										If NHibernate's built in Access Strategies are not what is needed for your situation
										then you can build your own by implementing the interface 
										<code class="literal">NHibernate.Property.IPropertyAccessor</code>.  The value of the 
										<code class="literal">access</code> attribute should be an Assembly Qualified Name that can be 
										loaded with <code class="literal">Activator.CreateInstance(string AssemblyQualifiedName)</code>.
									</p>
								</td></tr></tbody></table></div><p>
			</p><p>
				</p><div class="table"><a name="id410277"></a><p class="title"><b>Table 4.2. Naming Strategy</b></p><table summary="Naming Strategy" border="1"><colgroup><col><col></colgroup><thead><tr><th>Naming Strategy Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">camelcase</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is converted to CamelCase to find the Field.
										<code class="literal">&lt;property name="Foo" ... &gt;</code> uses the Field <code class="literal">foo</code>.
									</p>
								</td></tr><tr><td><code class="literal">camelcase-underscore</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is converted to CamelCase and prefixed with an
										underscore to find the Field.
										<code class="literal">&lt;property name="Foo" ... &gt;</code> uses the Field <code class="literal">_foo</code>.
									</p>
								</td></tr><tr><td><code class="literal">lowercase</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is converted to all LowerCase to find the Field.
										<code class="literal">&lt;property name="FooBar" ... &gt;</code> uses the Field <code class="literal">foobar</code>.
									</p>
								</td></tr><tr><td><code class="literal">lowercase-underscore</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is converted to all LowerCase and prefixed with an
										underscore to find the Field.
										<code class="literal">&lt;property name="FooBar" ... &gt;</code> uses the Field <code class="literal">_foobar</code>.
									</p>
								</td></tr><tr><td><code class="literal">pascalcase-underscore</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is prefixed with an underscore to find the Field.
										<code class="literal">&lt;property name="Foo" ... &gt;</code> uses the Field <code class="literal">_Foo</code>.
									</p>
								</td></tr><tr><td><code class="literal">pascalcase-m-underscore</code></td><td>
									<p>
										The <code class="literal">name</code> attribute is prefixed with the character
										<code class="literal">m</code> and an underscore to find the Field.
										<code class="literal">&lt;property name="Foo" ... &gt;</code> uses the Field <code class="literal">m_Foo</code>.
									</p>
								</td></tr></tbody></table></div><p>
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-manytoone"></a>4.1.10. many-to-one</h3></div></div></div><p>An ordinary association to another persistent class is declared
			using a many-to-one element. The relational model is a many-to-one
			association. (Its really just an object reference.) </p><pre class="programlisting">&lt;many-to-one
        name="propertyName"<a name="manytoone1-co"></a>(1)
        column="column_name"<a name="manytoone2-co"></a>(2)
        class="ClassName"<a name="manytoone3-co"></a>(3)
        cascade="all|none|save-update|delete"<a name="manytoone4-co"></a>(4)
        outer-join="true|false|auto"<a name="manytoone5-co"></a>(5)
        update="true|false"<a name="manytoone6-co"></a>(6)
        insert="true|false"<a name="manytoone7-co"></a>(7)
        property-ref="propertyNameFromAssociatedClass" <a name="manytoone8-co"></a>(8)
        access="field|property|ClassName"<a name="manytoone9-co"></a>(9)
        unique="true|false" <a name="manytoone10-co"></a>(10)
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="manytoone1"></a><a href="#manytoone1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">name</code>: The name of the property.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone2"></a><a href="#manytoone2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">column</code> (optional): The name of the column.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone3"></a><a href="#manytoone3-co">(3)</a> </td><td valign="top" align="left"><p>
						<code class="literal">class</code> (optional - defaults to the property type
						determined by reflection): The name of the associated class.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone4"></a><a href="#manytoone4-co">(4)</a> </td><td valign="top" align="left"><p>
						<code class="literal">cascade</code> (optional): Specifies which operations should
						be cascaded from the parent object to the associated object.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone5"></a><a href="#manytoone5-co">(5)</a> </td><td valign="top" align="left"><p>
						<code class="literal">outer-join</code> (optional - defaults to <code class="literal">auto</code>): 
						enables outer-join fetching for this association when 
						<code class="literal">hibernate.use_outer_join</code> is set.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone6"></a><a href="#manytoone6-co">(6)</a> </td><td valign="top" align="left"><p>
						<code class="literal">update, insert</code> (optional - defaults to <code class="literal">true</code>) 
						specifies that the mapped columns should be included in SQL <code class="literal">UPDATE</code> 
						and/or <code class="literal">INSERT</code> statements. Setting both to <code class="literal">false</code>
						allows a pure "derived" association whose value is initialized from some other
						property that maps to the same colum(s) or by a trigger or other application.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone8"></a><a href="#manytoone8-co">(8)</a> </td><td valign="top" align="left"><p>
						<code class="literal">property-ref</code>: (optional) The name of a property of the associated
						class that is joined to this foreign key.  If not specified, the primary key of the
						associated class is used.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone9"></a><a href="#manytoone9-co">(9)</a> </td><td valign="top" align="left"><p>
						<code class="literal">access</code> (optional - defaults to
						<code class="literal">property</code>): The strategy NHibernate should use for
						accessing the property value.
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="manytoone10"></a><a href="#manytoone10-co">(10)</a> </td><td valign="top" align="left"><p>
						<code class="literal">unique</code> (optional): Enable the DDL generation of a unique
						constraint for the foreign-key column.
					</p></td></tr></table></div><p>
			The <code class="literal">cascade</code> attribute permits the following values: 
			<code class="literal">all</code>, <code class="literal">save-update</code>, <code class="literal">delete</code>,
			<code class="literal">none</code>. Setting a value other than <code class="literal">none</code>
			will propagate certain operations to the associated (child) object.
			See "Lifecycle Objects" below.
		</p><p>
			The <code class="literal">outer-join</code> attribute accepts three different values:
		</p><div class="itemizedlist"><ul type="disc" compact><li><p>
					<code class="literal">auto</code> (default) Fetch the association using an
					outerjoin if the associated class has no proxy
				</p></li><li><p>
					<code class="literal">true</code> Always fetch the association using an 
					outerjoin
				</p></li><li><p>
					<code class="literal">false</code> Never fetch the association using an
					outerjoin
				</p></li></ul></div><p>
			A typical <code class="literal">many-to-one</code> declaration looks as simple as
		</p><pre class="programlisting">&lt;many-to-one name="Product" class="Product" column="PRODUCT_ID" /&gt;</pre><p>
			The <code class="literal">property-ref</code> attribute should only be used for mapping legacy
			data where a foreign key refers to a unique key of the associated table other than 
			the primary key.  This is an ugly relational model.  For example, suppose the 
			<code class="literal">Product</code> class had a unique serial number, that is not the primary
			key.  (The <code class="literal">unique</code> attribute controls NHibernate's DDL generation with
			the SchemaExport tool.)
		</p><pre class="programlisting">&lt;property name="SerialNumber" unique="true" type="String" column="SERIAL_NUMBER" </pre><p>
			Then the mapping for <code class="literal">OrderItem</code> might use:
		</p><pre class="programlisting">&lt;many-to-one name="Product property-ref="SerialNumber" column="PRODUCT_SERIAL_NUMBER" /&gt;</pre><p>
			This is certainly not encouraged, however.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-onetoone"></a>4.1.11. one-to-one</h3></div></div></div><p>
			A one-to-one association to another persistent class is declared using a 
			<code class="literal">one-to-one</code> element.
		</p><pre class="programlisting">&lt;one-to-one
	name="propertyName"<a name="onetoone1-co"></a>(1)
	class="ClassName"<a name="onetoone2-co"></a>(2)
	cascade="all|none|save-update|delete"<a name="onetoone3-co"></a>(3)
	constrained="true|false"<a name="onetoone4-co"></a>(4)
	outer-join="true|false|auto"<a name="onetoone5-co"></a>(5)
	property-ref="propertyNameFromAssociatedClass" <a name="onetoone6-co"></a>(6)
	access="field|property|ClassName"<a name="onetoone7-co"></a>(7)
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="onetoone1"></a><a href="#onetoone1-co">(1)</a> </td><td valign="top" align="left"><p>
					<code class="literal">name</code>: The name of the property.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone2"></a><a href="#onetoone2-co">(2)</a> </td><td valign="top" align="left"><p>
					<code class="literal">class</code> (optional - defaults to the property type
					determined by reflection): The name of the associated class.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone3"></a><a href="#onetoone3-co">(3)</a> </td><td valign="top" align="left"><p>
					<code class="literal">cascade</code> (optional) specifies which operations should
					be cascaded from the parent object to the associated object.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone4"></a><a href="#onetoone4-co">(4)</a> </td><td valign="top" align="left"><p>
					<code class="literal">contstrainted</code> (optional) specifies that a foreign key constraint
					on the primary key of the mapped table references the table of the associated 
					class.  This options affects the order in which <code class="literal">Save()</code> and 
					<code class="literal">Delete()</code> are cascaded (and is also used by the schema export tool).
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone5"></a><a href="#onetoone5-co">(5)</a> </td><td valign="top" align="left"><p>
					<code class="literal">outer-join</code> (optional - defaults to <code class="literal">auto</code>): 
					Enable outer-join fetching for this association when <code class="literal">hibernate.use_outer_join</code>
					is set.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone6"></a><a href="#onetoone6-co">(6)</a> </td><td valign="top" align="left"><p>
					<code class="literal">property-ref</code>: (optional): The name of a property of the associated class
					that is joined to the primary key of this class.  If not specified, the primary key of
					the associated class is used.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="onetoone7"></a><a href="#onetoone7-co">(7)</a> </td><td valign="top" align="left"><p>
					<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
					strategy NHibernate should use for accessing the property value.
				</p></td></tr></table></div><p>
			There are two varieties of one-to-one associations:
		</p><div class="itemizedlist"><ul type="disc"><li><p>primary key associations</p></li><li><p>unique foreign key associations</p></li></ul></div><p>
			Primary key associations don't need an extra table column; if two rows are related by
			the association then the two table rows share the same primary key value.  So if you want
			two objects to be related by a primary key association, you must make sure that they
			are assigned the same identifier value!
		</p><p>
			For a primary key association, add the following mappings to <code class="literal">Employee</code> and
			<code class="literal">Person</code>, respectively.
		</p><pre class="programlisting">&lt;one-to-one name="Person" class="Person" /&gt;</pre><pre class="programlisting">&lt;one-to-one name="Employee" class="Employee" constrained="true" /&gt;</pre><p>
			Now we must ensure that the primary keys of related rows in the PERSON and 
			EMPLOYEE table are equal.  We use a special identifier generation strategy
			call <code class="literal">foreign</code>:
		</p><pre class="programlisting">&lt;class name="Person" table="PERSON"&gt;
	&lt;id name="Id" column="PERSON_ID"&gt;
		&lt;generator class="foreign"&gt;
			&lt;param name="property"&gt;Employee&lt;/param&gt;
		&lt;/generator&gt;
	&lt;/id&gt;
	...
	&lt;one-to-one name="Employee"
		class="Employee"
		constrained="true" /&gt;
&lt;/class&gt;</pre><p>
			A newly saved instance of <code class="literal">Person</code> is then assigned the same primary
			key value as the <code class="literal">Employee</code> instance refered with the <code class="literal">Employee</code>
			property of that <code class="literal">Person</code>.
		</p><p>
			Alternatively, a foreign key with a unique constraint, from <code class="literal">Employee</code> to
			<code class="literal">Person</code>, may be expressed as:
		</p><pre class="programlisting">&lt;many-to-one name="Person" class="Person" column="PERSON_ID" unique="true" /&gt;</pre><p>
			And this association may be made bidirectional by adding the following to the
			<code class="literal">Person</code> mapping:
		</p><pre class="programlisting">&lt;one-to-one name="Employee" class="Employee" property-ref="Person" /&gt;</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-component"></a>4.1.12. component</h3></div></div></div><p>
			The <code class="literal">&lt;component&gt;</code> element maps properties of a
			child object to columns of the table of a parent class. Components may, in
			turn, declare their own properties, components or collections. See
			"Components" below.
		</p><pre class="programlisting">&lt;component
	name="propertyName"<a name="component1-co"></a>(1)
	class="ClassName"<a name="component2-co"></a>(2)
	insert="true|false"<a name="component3-co"></a>(3)
	update="true|false"<a name="component4-co"></a>(4)
	access="field|property|ClassName"<a name="component5-co"></a>(5)
&gt;
	&lt;parent ... /&gt;
	&lt;property ... /&gt;
	&lt;many-to-one ... /&gt;
	...
&lt;component/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="component1"></a><a href="#component1-co">(1)</a> </td><td valign="top" align="left"><p>
					<code class="literal">name</code>: The name of the property.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="component2"></a><a href="#component2-co">(2)</a> </td><td valign="top" align="left"><p>
					<code class="literal">class</code> (optional - defaults to the property type
					determined by reflection): The name of the component (child) class.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="component3"></a><a href="#component3-co">(3)</a> </td><td valign="top" align="left"><p>
					<code class="literal">insert</code>: Do the mapped columns appear in SQL 
					<code class="literal">INSERT</code>s?
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="component4"></a><a href="#component4-co">(4)</a> </td><td valign="top" align="left"><p>
					<code class="literal">update</code>: Do the mapped columns appear in SQL 
					<code class="literal">UPDATE</code>s?
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="component5"></a><a href="#component5-co">(5)</a> </td><td valign="top" align="left"><p>
					<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The
					strategy Hibernate should use for accessing the property value.
				</p></td></tr></table></div><p>
			The child <code class="literal">&lt;property&gt;</code> tags map properties of the 
			child class to table columns.
		</p><p>
			The <code class="literal">&lt;component&gt;</code> element allows a <code class="literal">&lt;parent&gt;</code>
			subelement that maps a property of the component class as a reference back to the 
			containig entity.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-subclass"></a>4.1.13. subclass</h3></div></div></div><p>
			Finally, polymorphic persistence requires the declaration of each subclass of
			the root persistent class. For the (recommended) table-per-class-hierarchy
			mapping strategy, the <code class="literal">&lt;subclass&gt;</code> declaration is used.
		</p><pre class="programlisting">&lt;subclass
	name="ClassName"<a name="subclass1-co"></a>(1)
	discriminator-value="discriminator_value"<a name="subclass2-co"></a>(2)
	proxy="ProxyInterface"<a name="subclass3-co"></a>(3)
	dynamic-update="true|false"
	dynamic-insert="true|false"
	extends="BaseMappedClassName"&gt; <a name="subclass4-co"></a>(4)
	
	&lt;property ... / &gt;
	...
&lt;subclass/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="subclass1"></a><a href="#subclass1-co">(1)</a> </td><td valign="top" align="left"><p>
					<code class="literal">name</code>: The fully qualified .NET Type name of the persistent class. 
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="subclass2"></a><a href="#subclass2-co">(2)</a> </td><td valign="top" align="left"><p>
					<code class="literal">discriminator-value</code> (optional - defaults to the class name): A 
					value that distinguishes individual subclasses.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="subclass3"></a><a href="#subclass3-co">(3)</a> </td><td valign="top" align="left"><p>
					<code class="literal">proxy</code> (optional): Specifies a class or interface to use 
					for lazy initializing proxies.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="subclass4"></a><a href="#subclass4-co">(4)</a> </td><td valign="top" align="left"><p>
					<code class="literal">extends</code> (optional): Specifies the mapped class that this
					subclass is extending.  This is only needed if <a href="#mapping-modularfiles" title="4.4. Modular mapping files">
					Modular Mapping Files</a> are used.
				</p></td></tr></table></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-joinedsubclass"></a>4.1.14. joined-subclass</h3></div></div></div><p>
			Alternatively, a subclass that is persisted to its own table (table-per-subclass 
			mapping strategy) is declared using a <code class="literal">&lt;joined-subclass&gt;</code>
			element.
		</p><pre class="programlisting">&lt;joined-subclass
	name="ClassName"<a name="joinedsubclass1-co"></a>(1)
	table="tableName" <a name="joinedsubclass2-co"></a>(2)
	proxy="ProxyInterface"<a name="joinedsubclass3-co"></a>(3)
	dynamic-update="true|false"
	dynamic-insert="true|false"
	extends="BaseMappedClassName"&gt; <a name="joinedsubclass4-co"></a>(4)
	
	&lt;key ... &gt;
	
	&lt;property ... / &gt;
	...
&lt;joined-subclass/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="joinedsubclass1"></a><a href="#joinedsubclass1-co">(1)</a> </td><td valign="top" align="left"><p>
					<code class="literal">name</code>: The fully qualified .NET Type name of the persistent class. 
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="joinedsubclass2"></a><a href="#joinedsubclass2-co">(2)</a> </td><td valign="top" align="left"><p>
					<code class="literal">table</code>: The name of the table that holds the data specific to this class.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="joinedsubclass3"></a><a href="#joinedsubclass3-co">(3)</a> </td><td valign="top" align="left"><p>
					<code class="literal">proxy</code> (optional): Specifies a class or interface to use 
					for lazy initializing proxies.
				</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="joinedsubclass4"></a><a href="#joinedsubclass4-co">(4)</a> </td><td valign="top" align="left"><p>
					<code class="literal">extends</code> (optional): Specifies the mapped class that this
					joined-subclass is extending.  This is only needed if 
					<a href="#mapping-modularfiles" title="4.4. Modular mapping files">Modular Mapping Files</a> are used.
				</p></td></tr></table></div><p>
			No discriminator column is required for this mapping strategy.  Each sublcass must, 
			however, declare a table column holding the object identifier using the 
			<code class="literal">&lt;key&gt;</code> element.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-collections"></a>4.1.15. map, set, list, bag</h3></div></div></div><p>
				Collections are discussed later.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-declaration-import"></a>4.1.16. import</h3></div></div></div><p>
				If your application has two persistent class with the same name, and you don't want to 
				specify the fully qualified name in NHibernate queries, then classes may be "imported"
				explicity, rather than relying on <code class="literal">auto-import="true"</code>.  Classes and interfaces
				that are not explicity mapped can be imported also.  This is useful when you want to query for
				classes that implement a certain interface or want to use an unmapped class to put the results
				of the hql in.
			</p><pre class="programlisting">&lt;import class="System.Object, System" /&gt;</pre><pre class="programlisting">&lt;import 
	class="className" <a name="import1-co"></a>(1)
	rename="newName"  <a name="import2-co"></a>(2)
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="import1"></a><a href="#import1-co">(1)</a> </td><td valign="top" align="left"><p>
						<code class="literal">class</code>:  The fully qualified .NET Type name of the persistent class (or interface).
					</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="import2"></a><a href="#import2-co">(2)</a> </td><td valign="top" align="left"><p>
						<code class="literal">rename</code> (optional - defaults to the unqualified class name): A
						name that may be used in the query language.
					</p></td></tr></table></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-types"></a>4.2. NHibernate Types</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-types-entitiesvalues"></a>4.2.1. Entities and values</h3></div></div></div><p>
				To understand the behaviour of various .NET language-level objects with respect
				to the persistence service, we need to classify them into two groups:
			</p><p>
				An <span class="emphasis"><em>entity</em></span> exists independently of any other objects holding
				references to the entity. Contrast this with the usual .NET model where an
				unreferenced object is garbage collected. Entities must be explicitly saved and
				deleted (except that saves and deletions may be <span class="emphasis"><em>cascaded</em></span>
				from a parent entity to its children).  Entities support
				circular and shared references. They may also be versioned.
			</p><p>
				An entity's persistent state consists of references to other entities and
				instances of <span class="emphasis"><em>value</em></span> types. Values are structs,
				collections, components and certain immutable objects. Unlike entities, values
				(in particular collections and components) <span class="emphasis"><em>are</em></span>
				persisted and deleted by reachability. Since value objects (and structs) are
				persisted and deleted along with their containing entity they may not be
				independently versioned. Values have no independent identity, so they cannot be
				shared by two entities or collections.
			</p><p>
				All NHibernate types except collections support null semantics if the .NET type also
				supports it.
			</p><p>
				Up until now, we've been using the term "persistent class" to refer to
				entities. We will continue to do that. Strictly speaking, however, not all
				user-defined classes with persistent state are entities. A
				<span class="emphasis"><em>component</em></span> is a user defined class with value semantics.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-types-basictypes"></a>4.2.2. Basic value types</h3></div></div></div><p>
				The <span class="emphasis"><em>basic types</em></span> may be roughly categorized into three groups - <code class="literal">System.ValueType</code> 
				types, <code class="literal">System.Object</code> types, and <code class="literal">System.Object</code> types for large objects.  Just like
				the .NET Types, columns for System.ValueType types <span class="emphasis"><em>can not</em></span> store <code class="literal">null</code> values 
				and System.Object types	<span class="emphasis"><em>can</em></span> store <code class="literal">null</code> values.
			</p><div class="table"><a name="id412251"></a><p class="title"><b>Table 4.3. System.ValueType Mapping Types</b></p><table summary="System.ValueType Mapping Types" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>NHibernate Type</th><th>.NET Type</th><th>Database Type</th><th>Remarks</th></tr></thead><tbody><tr><td><code class="literal">AnsiChar</code></td><td><code class="literal">System.Char</code></td><td><code class="literal">DbType.AnsiStringFixedLength - 1 char</code></td><td> </td></tr><tr><td><code class="literal">Boolean</code></td><td><code class="literal">System.Boolean</code></td><td><code class="literal">DbType.Boolean</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Byte</code></td><td><code class="literal">System.Byte</code></td><td><code class="literal">DbType.Byte</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Char</code></td><td><code class="literal">System.Char</code></td><td><code class="literal">DbType.StringFixedLength - 1 char</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">DateTime</code></td><td><code class="literal">System.DateTime</code></td><td><code class="literal">DbType.DateTime</code> - ignores the milliseconds</td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Decimal</code></td><td><code class="literal">System.Decimal</code></td><td><code class="literal">DbType.Decimal</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Double</code></td><td><code class="literal">System.Double</code></td><td><code class="literal">DbType.Double</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Guid</code></td><td><code class="literal">System.Guid</code></td><td><code class="literal">DbType.Guid</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Int16</code></td><td><code class="literal">System.Int16</code></td><td><code class="literal">DbType.Int16</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Int32</code></td><td><code class="literal">System.Int32</code></td><td><code class="literal">DbType.Int32</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Int64</code></td><td><code class="literal">System.Int64</code></td><td><code class="literal">DbType.Int64</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">PersistentEnum</code></td><td>A <code class="literal">System.Enum</code></td><td>The <code class="literal">DbType</code> for the underlying value.</td><td>Do not specify <code class="literal">type="PersistentEnum"</code> in the mapping.  Instead 
							specify the Assembly Qualified Name of the Enum or let NHibernate use Reflection to "guess" the Type.  
							The UnderlyingType of the Enum is used to determine the correct <code class="literal">DbType</code>.</td></tr><tr><td><code class="literal">Single</code></td><td><code class="literal">System.Single</code></td><td><code class="literal">DbType.Single</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Ticks</code></td><td><code class="literal">System.DateTime</code></td><td><code class="literal">DbType.Int64</code></td><td><code class="literal">type="Ticks"</code> must be specified.</td></tr><tr><td><code class="literal">TimeSpan</code></td><td><code class="literal">System.TimeSpan</code></td><td><code class="literal">DbType.Int64</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Timestamp</code></td><td><code class="literal">System.DateTime</code></td><td><code class="literal">DbType.DateTime</code> - as specific as database supports.</td><td><code class="literal">type="Timestamp"</code> must be specified.</td></tr><tr><td><code class="literal">TrueFalse</code></td><td><code class="literal">System.Boolean</code></td><td><code class="literal">DbType.AnsiStringFixedLength</code> - 1 char either 'T' or 'F'</td><td><code class="literal">type="TrueFalse"</code> must be specified.</td></tr><tr><td><code class="literal">YesNo</code></td><td><code class="literal">System.Boolean</code></td><td><code class="literal">DbType.AnsiStringFixedLength</code> - 1 char either 'Y' or 'N'</td><td><code class="literal">type="YesNo"</code> must be specified.</td></tr></tbody></table></div><div class="table"><a name="id412911"></a><p class="title"><b>Table 4.4. System.Object Mapping Types</b></p><table summary="System.Object Mapping Types" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>NHibernate Type</th><th>.NET Type</th><th>Database Type</th><th>Remarks</th></tr></thead><tbody><tr><td><code class="literal">AnsiString</code></td><td><code class="literal">System.String</code></td><td><code class="literal">DbType.AnsiString</code></td><td><code class="literal">type="AnsiString"</code> must be specified.</td></tr><tr><td><code class="literal">CultureInfo</code></td><td><code class="literal">System.Globalization.CultureInfo</code></td><td><code class="literal">DbType.String</code> - 5 chars for culture</td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Binary</code></td><td><code class="literal">System.Byte[]</code></td><td><code class="literal">DbType.Binary</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">Type</code></td><td><code class="literal">System.Type</code></td><td><code class="literal">DbType.String</code> holding Assembly Qualified Name.</td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr><tr><td><code class="literal">String</code></td><td><code class="literal">System.String</code></td><td><code class="literal">DbType.String</code></td><td>Default when no <code class="literal">type</code> attribute specified.</td></tr></tbody></table></div><div class="table"><a name="id413121"></a><p class="title"><b>Table 4.5. Large Object Mapping Types</b></p><table summary="Large Object Mapping Types" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>NHibernate Type</th><th>.NET Type</th><th>Database Type</th><th>Remarks</th></tr></thead><tbody><tr><td><code class="literal">StringClob</code></td><td><code class="literal">System.String</code></td><td><code class="literal">DbType.String</code></td><td><code class="literal">type="StringClob"</code> must be specified.  Entire field is read into memory.</td></tr><tr><td><code class="literal">BinaryBlob</code></td><td><code class="literal">System.Byte[]</code></td><td><code class="literal">DbType.Binary</code></td><td><code class="literal">type="BinaryBlob"</code> must be specified.  Entire field is read into memory.</td></tr><tr><td><code class="literal">Serializable</code></td><td>Any <code class="literal">System.Object</code> that is marked with SerializableAttribute.</td><td><code class="literal">DbType.Binary</code></td><td><code class="literal">type="Serializable"</code> should be specified.  This is the fallback type
							if no NHibernate Type can be found for the Property.</td></tr></tbody></table></div><p>
				For those of you coming over from Hibernate or using some of the tools to generate <code class="literal">hbm.xml</code> files
				that are intended for Hibernate, there is a Hibernate compatiblity layer for type names.  A <code class="literal">type="integer"</code>
				or <code class="literal">type="int"</code> will map to an <code class="literal">Int32</code> NHibernateType, <code class="literal">type="short"</code>
				to an <code class="literal">Int16</code> NHibernateType.  To see all of the conversions you can view the source of static constructor
				of the class <code class="literal">NHibernate.Type.TypeFactory</code>. 
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-types-custom"></a>4.2.3. Custom value types</h3></div></div></div><p>
				It is relatively easy for developers to create their own value types. For example,
				you might want to persist properties of type <code class="literal">Int64</code>
				to <code class="literal">VARCHAR</code> columns. NHibernate does not provide a built-in type 
				for this. But custom types are not limited to mapping a property (or collection element) 
				to a single table column. So, for example, you might have a property 
				<code class="literal">Name {get; set;}</code> of type <code class="literal">String</code> that is persisted to the columns 
				<code class="literal">FIRST_NAME</code>, <code class="literal">INITIAL</code>, <code class="literal">SURNAME</code>. 
			</p><p>
				To implement a custom type, implement either <code class="literal">NHibernate.IUserType</code> 
				or <code class="literal">NHibernate.ICompositeUserType</code> and declare properties using the 
				fully qualified name of the type. Check out 
				<code class="literal">NHibernate.DomainModel.DoubleStringType</code> to see the kind of things that 
				are possible.
			</p><pre class="programlisting">&lt;property name="TwoStrings" type="NHibernate.DomainModel.DoubleStringType, NHibernate.DomainModel"&gt;
	&lt;column name="first_string"/&gt;
	&lt;column name="second_string"/&gt;
&lt;/property&gt;</pre><p>
				Notice the use of <code class="literal">&lt;column&gt;</code> tags to map a property to multiple
				columns.
			</p><p>
				Even though NHibernate's rich range of built-in types and support for components means you
				will very rarely <span class="emphasis"><em>need</em></span> to use a custom type, it is nevertheless
				considered good form to use custom types for (non-entity) classes that occur frequently
				in your application. For example, a <code class="literal">MonetaryAmount</code> class is a good
				candidate for a <code class="literal">ICompositeUserType</code>, even though it could easily be mapped 
				as a component. One motivation for this is abstraction. With a custom type, your mapping 
				documents would be future-proofed against possible changes in your way of representing 
				monetary values.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-types-anymapping"></a>4.2.4. Any type mappings</h3></div></div></div><p>TODO</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-quotedidentifiers"></a>4.3. SQL quoted identifiers</h2></div></div></div><p>
			You may force NHibernate to quote an identifier in the generated SQL by enclosing the table or
			column name in backticks in the mapping document.  NHibernate will use the correct quotation
			style for the SQL <code class="literal">Dialect</code> (usually double quotes, but brackets for SQL
			Server and backticks for MySQL).
		</p><pre class="programlisting">
&lt;class name="LineItem" table="`Line Item`"&gt;
	&lt;id name="id" column="`Item Id`"&gt;
		&lt;generator class="assigned"/&gt;
	&lt;/id&gt;
	&lt;property name="itemNumber" column="`Item #`"/&gt;
	...
&lt;/class&gt;</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-modularfiles"></a>4.4. Modular mapping files</h2></div></div></div><p>
			It is possible to define <code class="literal">subclass</code> and <code class="literal">joined-subclass</code>
			mappings in seperate mapping documents, directly beneath <code class="literal">hibernate-mapping</code>.
			This allows you to extend a class hierachy just by adding a new mapping file. You must
			specify an <code class="literal">extends</code> attribute in the subclass mapping, naming a previously
			mapped superclass.  If you are configuring NHibernate by using Embedded Resources then the
			hbm.xml files are configured in the correct order.  If you are manually adding them or specifying
			them in the cfg.xml file then the ordering of the mapping documents is important!
		</p><pre class="programlisting">
&lt;hibernate-mapping&gt;
	&lt;subclass name="Eg.Subclass.DomesticCat, Eg" extends="Eg.Cat, Eg" discriminator-value="D"&gt;
		&lt;property name="Name" type="String"/&gt;
	&lt;/subclass&gt;
&lt;/hibernate-mapping&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="collections"></a>Chapter 5. Collection Mapping</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-persistent"></a>5.1. Persistent Collections</h2></div></div></div><p>
			This section does not contain much example .NET code.  We assume you already know
			how to use .NET's collections framework and the concepts behind a Set collection.  
			If so, there's not really anything more	to know - with a single caveat, you may 
			use collections the same way you always have.
		</p><p>
			NHibernate can persist instances of 
			<code class="literal">System.Collections.IDictionary</code>,
			<code class="literal">System.Collections.IList</code>,
			<code class="literal">Iesi.Collections.ISet</code>,
			and an arry of persistent entities or values.  Properties of type
			<code class="literal">System.Collections.ILst</code> may also
			be persisted with "bag" semantics.
		</p><p>
			Now the caveat: persistent collections do not retain any extra semantics added by the class
			implementing the collection interface (eg. iteration order of a <code class="literal">Iesi.Collections.ListSet</code>.
			The persistent collections actually behave like
			<code class="literal">System.Collections.Hashtable</code>,
			<code class="literal">System.Collections.ArrayList</code>,
			<code class="literal">Iesi.Collections.HashedSet</code> 
			respectively.  Furthermore, the .NET type of a property holding a collection must be
			the interface type (ie. <code class="literal">IDictionary</code>, <code class="literal">IList</code>, or
			<code class="literal">ISet</code>).  This restriction exists because NHibernate replaces your 
			instances of <code class="literal">IDictionary</code>, <code class="literal">IList</code>, and 
			<code class="literal">ISet</code> with instances of its own persistent implemetations of those 
			collection interfaces.  (So also be careful when using <code class="literal">==</code> on your
			collections.)
		</p><pre class="programlisting">Cat cat = new DomesticCat();
Cat kitten = new DomesticCat();
...
Iesi.Collections.ISet kittens = new Iesi.Collections.HashedSet();	
kittens.Add( kitten );
cat.Kittens = kittens;
session.Save( cat );
kittens = cat.Kittens; // Okay, kittens collection is an ISet
(Iesi.Collections.HashedSet)cat.Kittens; //Error! - a NHibernate.Collections.Set not Iesi.Collections.HashedSet</pre><p>
			Collections obey the usual rules for value types: no shared 
			references, created and deleted along with containing entity.  Due to the underlying
			relational model, they do not support null value semantics; NHibernate does not
			distinguish between a null collection reference and an empty collection.
		</p><p>
			Collections are automatically persisted when referenced by a persistent object
			and automattically deleted when unreferenced.  If a collection is passed from one
			persistent object to another, its elements might be moved from one table to
			another.  You shouldn't have to worry much about any of this.  Just use
			NHibernate's collections the same way you use ordinary .NET collections, but
			make sure you understand the semantic of bidirectional associations (discussed
			later) before using them. 
		</p><p>
			Collection instances are distinguished in the database by a foreign key to
			the owning entity.  This foreign key is referred to as the 
			<span class="emphasis"><em>collection key</em></span>.  The collection key is mapped by 
			the <code class="literal">&lt;key&gt;</code> element.
		</p><p>
			Collections may contain almost any other NHibernate type, including all basic types,
			custome types, entity types and components.  This is an important definition: An object
			in a collection can either be handled with "pass by value" semantics (it therefore
			fully depends on the collection owner) or it can be a reference to another entity 
			with its own lifecycle.  Collections may not contain other collections.  The contained type
			is referred to as the <span class="emphasis"><em>collection element type</em></span>.  Collection elements
			are mapped by <code class="literal">&lt;element&gt;</code>, <code class="literal">&lt;composite-element&gt;</code>,
			<code class="literal">&lt;one-to-many&gt;</code>, <code class="literal">&lt;many-to-many&gt;</code>, or
			<code class="literal">&lt;many-to-any&gt;</code>.  The first two map elements with value semantics, 
			the other three are used to map entity associations.
		</p><p>
			All collection types except <code class="literal">ISet</code> and bag have an <span class="emphasis"><em>index</em></span>
			column - a column that maps to an array or <code class="literal">IList</code> index or 
			<code class="literal">IDictionary</code>key.  The index of a <code class="literal">IDictionary</code> may be of any 
			basic type, an entity type or even a composite type (it may not be a collection).  The 
			index of an array or list is always of type	<code class="literal">Int32</code>.  Indexes are 
			mapped using <code class="literal">&lt;index&gt;</code>, <code class="literal">&lt;index-many-to-many&gt;</code>,
			<code class="literal">&lt;composite-index&gt;</code>, or <code class="literal">&lt;index-many-to-any&gt;</code>.
		</p><p>
			There are quite a range of mappings that can be generated for collections, 
			covering many common relational models.  We suggest you experiment with the
			schema generation tool to get a feeling for how various mapping declarations
			translate to database tables.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-mapping"></a>5.2. Mapping a Collection</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-ofvalues"></a>5.3. Collections of Values and Many-To-Many Associations</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-onetomany"></a>5.4. One-To-Many Associations</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-lazy"></a>5.5. Lazy Initialization</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-sorted"></a>5.6. Sorted Collections</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-idbag"></a>5.7. Using an &lt;idbag&gt;</h2></div></div></div><p>
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-bidirectional"></a>5.8. Bidirectional Associations</h2></div></div></div><p>
			A <span class="emphasis"><em>bidirectional association</em></span> allows navigation from both
			"ends" of the association.  Two kinds of bidirectional association are 
			supported:
			
			</p><div class="variablelist"><dl><dt><span class="term">one-to-many</span></dt><dd><p>
							<code class="literal">&lt;set&gt;</code> or <code class="literal">&lt;bag&gt;</code> at one
							end, single-valued at the other
						</p></dd><dt><span class="term">many-to-many</span></dt><dd><p>
							<code class="literal">&lt;set&gt;</code> or <code class="literal">&lt;bag&gt;</code> at both
							ends.
						</p></dd></dl></div><p>
		</p><p>
			Please note that NHibernate does not support bidirectional one-to-many associations
			with an indexed collection (list, map, or array) as the "many" end, you have to 
			use a set or bag mapping.
		</p><p>
			You may specify a bidirectional many-to-many association simply by mapping two
			many-to-many associations to the same database table and declaring one end as 
			<span class="emphasis"><em>inverse</em></span> (which end is your choice).  Here's an example of 
			a bidirectional many-to-many association from a class back to <span class="emphasis"><em>itself</em></span>
			(each category can have many items and each item can be in many categories):
		</p><pre class="programlisting">&lt;class name name="NHibernate.Auction.Category, NHibernate.Auction"&gt;
	&lt;id name="Id" column="ID"/&gt;
	...
	&lt;bag name="Items" table="CATEGORY_ITEM" lazy="true"&gt;
		&lt;key column="CATEGORY_ID" /&gt;
		&lt;many-to-many class="NHibernate.Auction.Category, NHibernate.Auction" column="ITEM_ID" /&gt;
	&lt;/bag&gt;
&lt;/class&gt;

&lt;class name="NHibernate.Auction.Item, NHibernate.Auction"&gt;
	&lt;id name="Id" column="ID" /&gt;
	
	&lt;!-- inverse end --&gt;
	&lt;bag name="Categories" table="CATEGORY_ITEM" inverse="true" lazy="true"&gt;
		&lt;key column="ITEM_ID" /&gt;
		&lt;many-to-many class="NHibernate.Auction.Category, NHibernate.Auction" column="CATEGORY_ID" /&gt;
	&lt;/bag&gt;
&lt;/class&gt;
</pre><p>
			Changes made only to the inverse end of the association are <span class="emphasis"><em>not</em></span>
			persisted.  This means that NHibernate has two representations in memory for every
			bidirectional association, one link from A to B and another link from B to A.  This
			is easier to understand if you think about the object model and how we create a 
			many-to-many relationship in .NET:
		</p><pre class="programlisting">
category.Items.Add( item ); // The category now "knows" about the relationship
item.Categories.Add( category ); // The item now "knows" about the relationship

session.Update( item ); // No effect, nothing will be saved!
session.Update( category ); // The relationship will be saved
</pre><p>
			The non-inverse side is used to save the in-memory representation to the database.
			We would get an unnecessary INSERT/UPDATE and probably even a foreign key violation
			if both would trigger changes!  This same is of course also true for bidirectional
			one-to-many associations.
		</p><p>
			You may map a bidirectional one-to-many association by mapping a one-to-many association
			to the same table column(s) as a many-to-one association and declaring the many-valued
			end <code class="literal">inverse="true"</code>.
		</p><pre class="programlisting">&lt;class name="Eg.Parent, Eg&gt;
	&lt;id name="Id" column="id" /&gt;
	...
	&lt;set name="Children" inverse="true" lazy="true"&gt;
		&lt;key column="parent_id" /&gt;
		&lt;one-to-many class="Eg.Child, Eg" /&gt;
	&lt;/set&gt;
&lt;/class&gt;

&lt;class name="Eg.Child, Eg"&gt;
	&lt;id name="Id" column="id" /&gt;
	....
	&lt;many-to-one name="Parent" class="Eg.Parent, Eg" column="parent_id" /&gt;
&lt;/class&gt;</pre><p>
			Mapping one end of an association with <code class="literal">inverse="true"</code> doesn't
			affect the operation of cascades, both are different concepts!
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-ternary"></a>5.9. Ternary Associations</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-heterogeneous"></a>5.10. Heterogeneous Associations</h2></div></div></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="collections-example"></a>5.11. Collection examples</h2></div></div></div><p></p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="associations"></a>Chapter 6. Association Mappings</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="assoc-intro"></a>6.1. Introduction</h2></div></div></div><p>
			Association mappings are often the most difficult thing to get right.  In
			this section we'll go through the canonical cases one by one, starting 
			with unidirectional mappings, and then considering the bidirectional cases.
			We'll use <code class="literal">Person</code> and <code class="literal">Address</code> in all
			the examples.  The namespace and assembly are not included in the example
			mappings to keep the mappings focused on the important aspects.			
		</p><p>
			We'll classify associations by wheter or not they map to an intervening
			join table, and by multiplicity.
		</p><p>
			Nullable foreign keys are not considered good practive in traditional data
			modeling, so all our examples use not null foreign keys.  This is not a 
			requirement of NHibernate, and the mappings will all work if you drop the
			nullability constraints.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="assoc-unidirectional"></a>6.2. Unidirectional associations</h2></div></div></div><p>
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-m21"></a>6.2.1. many to one</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-121"></a>6.2.2. one to one</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-12m"></a>6.2.3. one to many</h3></div></div></div><p></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="assoc-unidirectional-join"></a>6.3. Unidirectional associations with join tables</h2></div></div></div><p></p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-join-12m"></a>6.3.1. one to many</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-join-m21"></a>6.3.2. many to one</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-join-121"></a>6.3.3. one to one</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-unidirectional-join-m2m"></a>6.3.4. many to many</h3></div></div></div><p></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="assoc-bidirectional"></a>6.4. Bidirectional associations</h2></div></div></div><p></p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-bidirectional-m21"></a>6.4.1. one to many / many to one</h3></div></div></div><p>
				A <span class="emphasis"><em>bidirectional one-to-many association</em></span> is the
				most common kind of association.  (This is the standard parent/child
				relationship.)
			</p><pre class="programlisting">&lt;class name="Person"&gt;
	&lt;id name="Id" column="personId"&gt;
		&lt;generator class="native" /&gt;
	&lt;/id&gt;
	&lt;many-to-one name="Address"
		column="addressId"
		not-null="true"
	/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
	&lt;id name="Id" column="addressId"&gt;
		&lt;generator class="native" /&gt;
	&lt;/id&gt;
	&lt;set name="People" inverse="true"&gt;
		&lt;key column="addressId" /&gt;
		&lt;one-to-many class="Person" /&gt;
	&lt;/set&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person 
(
	personId bigint not null primary key,
	addressId bigint not null
)

create table Address
(
	addressId bigint not null primary key
)
	
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-bidirectional-121"></a>6.4.2. one to one</h3></div></div></div><p></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="assoc-bidirectional-join"></a>6.5. Bidirectional associations with join tables</h2></div></div></div><p></p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-bidirectional-join-12m"></a>6.5.1. one to many / many to one</h3></div></div></div><p>
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-bidirectional-join-121"></a>6.5.2. one to one</h3></div></div></div><p></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="assoc-bidirectional-join-m2m"></a>6.5.3. many to many</h3></div></div></div><p></p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="example-parentchild"></a>Chapter 7. Example: Parent/Child</h2></div></div></div><p>
        One of the very first things that new users try to do with NHibernate is to model a parent / child type 
        relationship. There are two different approaches to this. For various reasons the most convenient 
        approach, especially for new users, is to model both <code class="literal">Parent</code> and <code class="literal">Child</code> 
        as entity classes with a <code class="literal">&lt;one-to-many&gt;</code> association from <code class="literal">Parent</code> 
        to <code class="literal">Child</code>. (The alternative approach is to declare the <code class="literal">Child</code> as a 
        <code class="literal">&lt;composite-element&gt;</code>.) Now, it turns out that default semantics of a one to many 
        association (in NHibernate) are much less close to the usual semantics of a parent / child relationship than 
        those of a composite element mapping. We will explain how to use a <span class="emphasis"><em>bidirectional one to many 
        association with cascades</em></span> to model a parent / child relationship efficiently and elegantly. It's 
        not at all difficult!
    </p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-parentchild-collections"></a>7.1. A note about collections</h2></div></div></div><p>
			NHibernate collections are considered to be a logical part of the their owning entity; never of the
			contained entities.  This is a crucial distinction!  It has the following consequences:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					When we remove/add an object from/to a collection, the version number of the collection owner
					is incremented.  
				</p></li><li><p>
					If an object that was removed from a collection is an instance of a value type (eg, a composite
					element), that object will cease to be persistent and its state will be completely removed from
					the database.  Likewise, adding a value type instance to the collection will cause its state to
					be immediately persistent.
				</p></li><li><p>
					On the other hand, if an entity is removed from a collection (a one-to-many or many-to-many
					association), it will not be deleted, by default.  This behavior is completely consistent - a 
					change to the internal state of another entity should not cause the associated entity to vanish!
					Likewise, adding an entity to a collection does not cause that entity to become persistent, by
					default.
				</p></li></ul></div><p>
			Instead, the default behavior is that adding an entity to a collection merely creates a link between
			the two entities, while removing it removes the link.  This is very appropriate for all sorts of cases.
			Where it is not appropriate at all is the case of a parent/child relationship, where the life of the 
			child is bound to the lifecycle of the parent.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-parentchild-bidir"></a>7.2. Bidirectional one-to-many</h2></div></div></div><p>
			Suppose we start with a simple <code class="literal">&lt;one-to-many&gt;</code> association from
			<code class="literal">Parent</code> to <code class="literal">Child</code>.
		</p><pre class="programlisting">&lt;set name="Children"&gt;
	&lt;key column="parent_id" /&gt;
	&lt;one-to-many class="Child" /&gt;
&lt;/set&gt;</pre><p>
			If we were to execute the following code
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = new Child();
p.Children.Add( c );
session.Save( c );
session.Flush();
</pre><p>
			NHibernate would issue two SQL statements:
		</p><div class="itemizedlist"><ul type="disc"><li><p>an <code class="literal">INSERT</code> to create the record for <code class="literal">c</code></p></li><li><p>
					an <code class="literal">UPDATE</code> to create the link from <code class="literal">p</code> to
					<code class="literal">c</code>
				</p></li></ul></div><p>
			This is not only inefficient, but also violates any <code class="literal">NOT NULL</code> constraint on the 
			<code class="literal">parent_id</code> column.
		</p><p>
			The underlying cause is that the link (the foreign key <code class="literal">parent_id</code>) from
			<code class="literal">p</code> to <code class="literal">c</code> is not considered part of the state of the <code class="literal">Child</code>
			object and is therefore not created in the <code class="literal">INSERT</code>.  So the solution is to make the link part
			of the <code class="literal">Child</code> mapping.
		</p><pre class="programlisting">&lt;many-to-one name="Parent" column="parent_id" not-null="true"</pre><p>
			(We also need to add the <code class="literal">Parent</code> property to the <code class="literal">Child</code> class.)
		</p><p>
			Now that the <code class="literal">Child</code> entity is managing the state of the link, we tell the collection not
			to update the link.  We use the <code class="literal">inverse</code> attribute.
		</p><pre class="programlisting">&lt;set name="Children" inverse="true"&gt;
	&lt;key column="parent_id" /&gt;
	&lt;one-to-many class="Child" /&gt;
&lt;/set&gt;</pre><p>
			The following code would be used to add a new <code class="literal">Child</code>.
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = new Child();
c.Parent = p;
p.Children.Add( c );
session.Save( c );
session.Flush();
</pre><p>
			An now, only one SQL <code class="literal">INSERT</code> would be issued!
		</p><p>
			To tighten things up a bit, we could create an <code class="literal">AddChild()</code> method in
			<code class="literal">Parent</code>.
		</p><pre class="programlisting">public void AddChild( Child c ) 
{
	this.Children.Add( c );
	c.Parent = this;
}
</pre><p>
			The <code class="literal">AddChild</code> method would simplify the code to
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = new Child();
p.AddChild( c );  //  
session.Save( c );
session.Flush();
</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-parentchild-cascades"></a>7.3. Cascading lifecycle</h2></div></div></div><p>
			The explicit call to <code class="literal">Save()</code> is still annoying.  We will address this by
			using cascades.
		</p><pre class="programlisting">&lt;set name="Children" inverse="true" cascade="all"&gt;
	&lt;key column="parent_id" /&gt;
	&lt;one-to-many class="Child" /&gt;
&lt;/set&gt;</pre><p>
			This simplifies the code above to
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = new Child();
p.AddChild( c );
session.Flush();
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				Cascades depend heavily upon the <code class="literal">unsaved-value</code> attribute.  Please ensure that 
				the default value of the <code class="literal">&lt;id&gt;</code> property is the same as 
				the <code class="literal">unsaved-value</code>.  
			</p></div><p>
			Similarily, we don't need to iterate over the children when saving or deleting a <code class="literal">Parent</code>.
			The following removes <code class="literal">p</code> and all its children from the database.
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
session.Delete( p );
session.Flush();
</pre><p>
			However, this code
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = null;
foreach( Child child in p.Children ) 
{
	c = child; // only care about first Child
	break;
}

p.Children.Remove( c );
c.Parent = null;

session.Flush();</pre><p>
			will not remove <code class="literal">c</code> from the database; it will only remove the link to <code class="literal">p</code>
			(and cause a <code class="literal">NOT NULL</code> constraint violation, in this case).  You need to explicitly
			<code class="literal">Delete()</code> the <code class="literal">Child</code>.
		</p><pre class="programlisting">Parent p = session.Load( typeof( Parent ), pid ) as Parent;
Child c = null;
foreach( Child child in p.Children ) 
{
	c = child; // only care about first Child
	break;
}

p.Children.Remove( c );
c.Parent = null;

session.Delete( c );
session.Flush();</pre><p>
			Now, in our case, a <code class="literal">Child</code> can't really exist without its parent.  So if we remove
			a <code class="literal">Child</code> from the collection, we really want it to be deleted.  For this, we must
			use <code class="literal">cascade="all-delete-orphan"</code>.
		</p><pre class="programlisting">&lt;set name="Children" inverse="true" cascade="all-delete-orphan"&gt;
	&lt;key column="parent_id" /&gt;
	&lt;one-to-many class="Child" /&gt;
&lt;/set&gt;</pre><p>
			Note: even though the collection mapping specifies <code class="literal">inverse="true"</code>, cascades are still
			processed by iterating the collection elements.  So if you require that an object be saved, deleted or
			updated by cascade, you must add it to the collection.  It is not enough to simply call the
			<code class="literal">Child.Parent</code> setter.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-parentchild-update"></a>7.4. Using cascading <code class="literal">update()</code></h2></div></div></div><p>
			Suppose we loaded up a <code class="literal">Parent</code> in one <code class="literal">ISession</code>, mode some changes in a UI
			action and wish to persist these changes in a new ISession (by calling <code class="literal">Update()</code>).  The
			<code class="literal">Parent</code> will contain a collection of children and, since cascading update is enabled, NHibernate
			needs to know which children are newly instantiated and which represent existing rows in the database.  Lets assume
			that both <code class="literal">Parent</code> and <code class="literal">Child</code> have (synthetic) identifier properties of type
			<code class="literal">System.Int32</code>.  NHibernate will use the identifier property value to determine which of the
			children are new.  (You may also use the version or timestamp property
			
		</p><p>
			The <code class="literal">unsaved-value</code> attribute is used to specify the identifier value of a newly instantiated
			instance.  <code class="literal">unsaved-value</code> defaults to "null", which is not a sensible default in the .net with
			ValueTypes, so you need to specify the unsaved-value
		</p><pre class="programlisting">&lt;id name="Id" type="Int64" unsaved-value="0" </pre><p>
			for the <code class="literal">Child</code> mapping.  (There is also an <code class="literal">unsaved-value</code> attribute
			for version and timestamp property mappings.)
		</p><p>
			The following code will update <code class="literal">parent</code> and <code class="literal">child</code> and insert
			<code class="literal">newChild</code>.
		</p><pre class="programlisting">//parent and child were both loaded in a previous session
parent.AddChild( child );
Child newChild = new Child();
parent.AddChild( newChild );
session.Update( parent );
session.Flush();</pre><p>
			Well, thats all very well for the case of generated identifier, but what about assigned identifiers
			and composite identifiers?  This is more difficult, since <code class="literal">unsaved-values</code> can't 
			distinguish between a newly instantiated object (with an identifier assigned by the user) and an object
			loaded in a previous session.  In these cases, you will probably need to give NHibernate a hint; either
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					define <code class="literal">unsaved-value="null"</code> or <code class="literal">unsaved-value="negative"</code> or
					<code class="literal">unsaved-value="parsablestring"</code>on a <code class="literal">&lt;version&gt;</code> 
					or <code class="literal">&lt;timestamp&gt;</code> property mapping for the class.
				</p></li><li><p>
					set <code class="literal">unsaved-value="none"</code> and explicitly <code class="literal">Save()</code>
					newly instantiated children before calling <code class="literal">Update( parent )</code>
				</p></li><li><p>
					set <code class="literal">unsaved-value="any"</code> and explicitly <code class="literal">Update()</code>
					previously persistent children before calling <code class="literal">Update( parent )</code>
				</p></li></ul></div><p>
			<code class="literal">none</code> is the default <code class="literal">unsaved-value</code> for assigned and composite
			identifiers.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-parentchild-conclusion"></a>7.5. Conclusion</h2></div></div></div><p>
			There is quite a bit to digest here and it might look confusing first time around.  However, in practice, it
			all works out quite nicely.  Most NHibernate applications use the parent/child pattern in many places.
		</p><p>
			We mentioned an alternative in the first paragraph.  None of the above issues exist in the case of
			<code class="literal">&lt;composite-element&gt;</code> mappings, which have exactly the semantics of a parent / child
			relationship.  Unfortunately, there are two big limitations to composite element classes:  composite elements may
			not own collections, and they should not be the child of any entity other than the unique parent.  (However,
			they <span class="emphasis"><em>may</em></span> have a surrogate primary key, using an <code class="literal">&lt;idbag&gt;</code> mapping.)
		</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="part-contrib"></a>Part II. NHibernateContrib Documentation</h1></div></div></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="contrib-preface"></a>Preface</h2></div></div></div><p>The NHibernateContrib is various programs contributed to NHibernate by members of the NHibernate Team or by the end users. The projects in here are not considered core pieces of NHibernate but they extend it in a useful way.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="caches"></a>Chapter 8. NHibernate.Caches</h2></div></div></div><div class="abstract"><a name="NHibernate.Caches-abstract"></a><p class="title"><b>What is NHibernate.Caches?</b></p><p><b>NHibernate.Caches are add-ins for <a href="http://www.nhibernate.org" target="_blank">NHibernate</a> contributed by Kevin Williams (aka <span class="emphasis"><em>k-dub</em></span>). </b>A cache is place where entities are kept (at their first loading); once in cache, they can be retrieved without having to query them (again) in the back-end storage. This means that they are faster to (re)load.</p><p>An NHibernate session has an internal (first-level) cache where it keeps its entities. There is no share between these caches; so a session is destroyed with its cache. NHibernate provides a <span class="emphasis"><em>second-level cache</em></span> system; it works at the SessionFactory level. So it is shared by all sessions created by the same SessionFactory.</p><p>An important point is that the second-level cache <span class="strong"><strong>does not</strong></span> cache instances of the object type being cached; instead it caches the individual values of the properties of that object. This provides two benefits. One, NHibernate doesn't have to worry that your client code will manipulate the objects in a way that will disrupt the cache. Two, the relationships and associations do not become stale, and are easy to keep up-to-date because they are simply identifiers. The cache is not a tree of objects but rather a map of arrays.</p><p>With the <span class="emphasis"><em>session-per-request</em></span> model, a high number of Session can concurrently access to the same entity without hitting the database each time; hence the performance gain.</p><p>These contributions make it possible to use different cache providers for NHibernate:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						<span class="strong"><strong>NHibernate.Caches.Prevalence</strong></span> makes it possible to use the underlying <code class="classname">Bamboo.Prevalence</code> implementation as cache provider. Open the file <code class="filename">Bamboo.Prevalence.license.txt</code> for more information about its license; you can also visit its <a href="http://bbooprevalence.sourceforge.net/" target="_blank">website</a>.</p></li><li><p>
						<span class="strong"><strong>NHibernate.Caches.SysCache</strong></span> makes it possible to use the underlying <code class="classname">System.Web.Caching.Cache</code> implementation as cache provider. This means that you can rely on ASP.NET caching feature to understand how it works. For more information, read (on the MSDN): <a href="http://msdn.microsoft.com/library/en-us/cpguide/html/cpconcacheapis.asp" target="_blank">Caching Application Data</a>.</p></li></ul></div><p>
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NHibernate.Caches-howto"></a>8.1. How to use them?</h2></div></div></div><p>Here are the steps to follow to enable the second-level cache in NHibernate:</p><p>
			</p><div class="itemizedlist"><ul type="disc"><li><p>Choose the cache provider you want to use and copy its assembly in your assemblies directory (<code class="filename">NHibernate.Caches.Prevalence.dll</code> or <code class="filename">NHibernate.Caches.SysCache.dll</code>).</p></li><li><p>To tells which cache provider to use, add in your NHibernate configuration file (can be <code class="filename">YourAssembly.exe.config</code> or <code class="filename">web.config</code> or a <code class="filename">.cfg.xml</code> file):
					</p><pre class="programlisting">
&lt;add key="hibernate.cache.provider_class" value="<code class="literal">XXX</code>" /&gt;<a name="hibernate.cache.provider_class-co" href="#hibernate.cache.provider_class">(1)</a>
&lt;add key="relativeExpiration" value="<code class="literal">120</code>" /&gt;<a name="nhcaches-relativeExpiration-co" href="#nhcaches-relativeExpiration">(2)</a>
						</pre><p>
						</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="hibernate.cache.provider_class"></a><a href="#hibernate.cache.provider_class-co">(1)</a> </td><td valign="top" align="left"><p>"<code class="literal">XXX</code>" can either be "<code class="classname">NHibernate.Caches.Prevalence.PrevalenceCacheProvider, NHibernate.Caches.Prevalence</code>" or "<code class="classname">NHibernate.Caches.SysCache.SysCacheProvider, NHibernate.Caches.SysCache</code>".</p></td></tr><tr><td width="5%" valign="top" align="left"><a name="nhcaches-relativeExpiration"></a><a href="#nhcaches-relativeExpiration-co">(2)</a> </td><td valign="top" align="left"><p>The <code class="literal">relativeExpiration</code> value is the number of seconds you wish to cache each entry (here two minutes). This example applies to SysCache only.</p></td></tr></table></div><p>
					</p></li><li><p>Add <span class="strong"><strong>&lt;cache usage="read-write|nonstrict-read-write|read-only"/&gt;</strong></span> (just after <span class="emphasis"><em>&lt;class&gt;</em></span>) in the mapping of the entities you want to cache. It also works for collections (bag, list, map, set, ...).</p></li></ul></div><p>
		</p><p><b>Be careful. </b>Caches are never aware of changes made to the persistent store by another process (though they may be configured to regularly expire cached data). As the caches are created at the SessionFactory level, they are destroyed with the SessionFactory instance; so you must keep it alive as long as you need them.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NHibernate.Caches.Prevalence"></a>8.2. Prevalence Cache Configuration</h2></div></div></div><p>There is only one configurable parameter: prevalenceBase. This is the directory on the file system where the Prevalence engine will save data. It can be relative to the current directory or a full path. If the directory doesn't exist, it will be created.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NHibernate.Caches.SysCache"></a>8.3. SysCache Configuration</h2></div></div></div><p>As the SysCache relies on <code class="classname">System.Web.Caching.Cache</code> for the underlying implementation, the configuration is based on the available options that make sense for NHibernate to utilize.</p><p>
			</p><div class="itemizedlist"><ul type="disc"><li><p>staticExpiration = a specific DateTime to expire each item on</p></li><li><p>relativeExpiration = number of seconds to wait before expiring each item</p></li><li><p>priority = a numeric cost of expiring each item, where 1 is a low cost, 5 is the highest, and 3 is normal. Only values 1 through 5 are valid.</p></li></ul></div><p>
		</p><p>SysCache has a config file section handler to allow configuring different expirations and priorities for different regions. Here's an example:</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;configuration&gt;
	&lt;configSections&gt;
		&lt;section name="syscache" type="NHibernate.Caches.SysCache.SysCacheSectionHandler,NHibernate.Caches.SysCache" /&gt;
		&lt;section name="nhibernate" type="System.Configuration.NameValueSectionHandler, System, Version=1.0.5000.0,Culture=neutral, PublicKeyToken=b77a5c561934e089" /&gt;
		&lt;section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" /&gt;
	&lt;/configSections&gt;

	&lt;syscache&gt;
		&lt;cache region="foo" relativeExpiration="500" priority="4" /&gt;
		&lt;cache region="bar" staticExpiration="2100-12-31" /&gt;
	&lt;/syscache&gt;
	&lt;nhibernate&gt;
		&lt;add key="hibernate.connection.provider" value="NHibernate.Connection.DriverConnectionProvider" /&gt;
		&lt;add key="hibernate.connection.isolation" value="ReadCommitted" /&gt;
		&lt;add key="hibernate.dialect" value="NHibernate.Dialect.MsSql2000Dialect" /&gt;
		&lt;add key="hibernate.connection.driver_class" value="NHibernate.Driver.SqlClientDriver" /&gt;
		&lt;add key="hibernate.connection.connection_string"  value="Server=localhost;initial catalog=nhibernate;Integrated Security=SSPI" /&gt;
		&lt;add key="hibernate.cache.provider_class" value="NHibernate.Caches.SysCache.SysCacheProvider,NHibernate.Caches.SysCache" /&gt;
	&lt;/nhibernate&gt;
	&lt;log4net debug="true"&gt;&lt;appender name="rollingFile" type="log4net.Appender.RollingFileAppender,log4net" &gt;
			&lt;param name="File" value="log.txt" /&gt;
			&lt;param name="AppendToFile" value="true" /&gt;
			&lt;param name="RollingStyle" value="Date" /&gt;
			&lt;param name="DatePattern" value="yyyy.MM.dd" /&gt;
			&lt;param name="StaticLogFileName" value="true" /&gt;
			&lt;layout type="log4net.Layout.PatternLayout,log4net"&gt;
				&lt;param name="ConversionPattern" value="%d [%t] %-5p %c [%x] &amp;lt;%X{auth}&amp;gt; - %m%n" /&gt;
			&lt;/layout&gt;
		&lt;/appender&gt;
		&lt;root&gt;
			&lt;priority value="ALL" /&gt;
			&lt;appender-ref ref="rollingFile" /&gt;
		&lt;/root&gt;
	&lt;/log4net&gt;
&lt;/configuration&gt;
		</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mapping-attributes"></a>Chapter 9. NHibernate.Mapping.Attributes</h2></div></div></div><div class="abstract"><a name="mapping-attributes-abstract"></a><p class="title"><b>What is NHibernate.Mapping.Attributes?</b></p><p><b>NHibernate.Mapping.Attributes is an add-in for <a href="http://www.nhibernate.org" target="_blank">NHibernate</a> contributed by Pierre Henri Kuaté (aka <span class="emphasis"><em>KPixel</em></span>); the former implementation was made by John Morris. </b>NHibernate require mapping streams to bind your domain model to your database. Usually, they are written (and maintained) in separated hbm.xml files.</p><p>With NHibernate.Mapping.Attributes, you can use .NET attributes to decorate your entities and this attributes will be used to generate these mapping .hbm.xml (as files or streams). So you will no longer have to bother with this <span class="emphasis"><em>nasty</em></span> xml files ;).</p><p><b>Content of this library. </b>
				</p><div class="itemizedlist"><ul type="disc"><li><p>
							<span class="strong"><strong>NHibernate.Mapping.Attributes</strong></span>: That the only project you need (as end-user)</p></li><li><p>
							<span class="strong"><strong>Test</strong></span>: a working sample using attributes and HbmSerializer as NUnit TestFixture</p></li><li><p>
							<span class="strong"><strong>Generator</strong></span>: The program used to generate attributes and HbmWriter</p></li><li><p>
							<a href="http://mbunit.tigris.org/" target="_blank">
								<span class="strong"><strong>Refly</strong></span>
							</a>: Thanks to <a href="http://www.dotnetwiki.org/" target="_blank">Jonathan de Halleux</a> for this library which make it so easy to generate code</p></li></ul></div><p>
			</p><p>
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					This library is generated using the file <code class="filename">/src/NHibernate.Mapping.Attributes/nhibernate-mapping-2.0.xsd</code>
					(which is embedded in the assembly to be able to validate generated XML streams).
					As this file can change at each new release of NHibernate, you should regenerate it before using it
					with a different version (open the Generator solution, compile and run the Generator project).
					But, no test has been done with versions prior to 0.8.
				</p></div><p>
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-attributes-howto"></a>9.1. How to use it?</h2></div></div></div><p><b>The <span class="emphasis"><em>end-user class</em></span> is <code class="classname">NHibernate.Mapping.Attributes.HbmSerializer</code>. </b>This class <span class="emphasis"><em>serialize</em></span> your domain model to mapping streams. You can either serialize classes one by one or an assembly. Look at <code class="classname">NHibernate.Mapping.Attributes.Test</code> project for a working sample.</p><p>The first step is to decorate your entities with attributes; you can use: <code class="classname">[Class]</code>, <code class="classname">[Subclass]</code>, <code class="classname">[JoinedSubclass]</code> or <code class="classname">[Component]</code>. Then, you decorate your members (fields/properties); they can take as many attributes as required by your mapping. Eg:</p><pre class="programlisting">
    [NHibernate.Mapping.Attributes.Class]
    public class Example
    {
        [NHibernate.Mapping.Attributes.Property]
        public string Name;
    }</pre><p>After this step, you use <code class="classname">NHibernate.Mapping.Attributes.HbmSerializer</code>: (here, we use <code class="methodname">Default</code> which is an instance you can use if you don't need/want to create it yourself).</p><pre class="programlisting">
    System.IO.MemoryStream stream = new System.IO.MemoryStream(); // where the xml will be written
    NHibernate.Mapping.Attributes.HbmSerializer.Default.Validate = true; // Enable validation (optional)
    // Here, we serialize all decorated classes (but you can also do it class by class)
    NHibernate.Mapping.Attributes.HbmSerializer.Default.Serialize(
        stream, System.Reflection.Assembly.GetExecutingAssembly() );
    stream.Position = 0; // Rewind
    NHibernate.Cfg.Configuration cfg = new NHibernate.Cfg.Configuration();
    cfg.Configure();
    cfg.AddInputStream(stream); // Use the stream here
    stream.Close();
    // Now you can use this configuration to build your SessionFactory...</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				As you can see here: NHibernate.Mapping.Attributes is <span class="strong"><strong>not</strong></span> (really) intrusive.
				Setting attributes on your objects doesn't force you to use them with NHibernate and doesn't break any constraint on your architecture.
				Attributes are purely informative!
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-attributes-tips"></a>9.2. Tips</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Use <code class="methodname">HbmSerializer.Validate</code> to enable/disable the validation of generated xml streams (against NHibernate mapping schema); this is useful to quickly find errors (they are written in StringBuilder <code class="methodname">HbmSerializer.Error</code>). If the error is due to this library then see if it is a know issue and report it; you can contribute a solution if you solve the problem :)</p></li><li><p>Your classes, fields and properties (members) can be private; just make sure that you have the permission to access private members using reflection (<code class="methodname">ReflectionPermissionFlag.MemberAccess</code>).</p></li><li><p>Members of a mapped classes are also seek in its base classes (until we reach <span class="emphasis"><em>mapped</em></span> base class). So you can decorate some members of a (not mapped) base class and use it in its (mapped) sub class(es).</p></li><li><p>For a Name taking a <code class="classname">System.Type</code>, set the type with <code class="methodname">Name</code><code class="literal">="xxx"</code> (as <code class="classname">string</code>) or <code class="methodname">Name</code><code class="literal">Type=typeof(xxx)</code>; (add "<code class="literal">Type</code>" to "<code class="methodname">Name</code>")</p></li><li><p>By default, .NET attributes don't keep the order of attributes; so you need to set it yourself when the order matter (using the first parameter of each attribute); it is <span class="emphasis"><em>highly</em></span> recommended to set it when you have more than one attribute on the same member.</p></li><li><p>As long as there is no ambiguity, you can decorate a member with many unrelated attributes. A good example is to put class-related attributes (like <code class="literal">&lt;discriminator&gt;</code>) on the identifier member. But don't forget that the order matters (the <code class="literal">&lt;discriminator&gt;</code> must be after the <code class="literal">&lt;id&gt;</code>). The order used comes from the order of elements in the NHibernate mapping schema. Personally, I prefer using negative numbers for these attributes (if they come before!).</p></li><li><p>You can add <code class="classname">[HibernateMapping]</code> on your classes to specify <code class="literal">&lt;hibernate-mapping&gt;</code> attributes (used when serializing the class in its stream). You can also use <code class="methodname">HbmSerializer.Hbm*</code> properties (used when serializing an assembly or a type that is not decorated with <code class="classname">[HibernateMapping]</code>).</p></li><li><p>Instead of using a string for <code class="methodname">DiscriminatorValue</code> (in <code class="classname">[Class]</code> and <code class="classname">[Subclass]</code>), you can use any object you want. Example: </p><pre class="programlisting">[Subclass(DiscriminatorValueEnumFormat="d", DiscriminatorValueObject=DiscEnum.Val1)]</pre><p> Here, the object is an Enum, and you can set the format you want (the default value is "g"). Note that you must put it <span class="strong"><strong>before</strong></span>! For others types, It simply use the <code class="methodname">ToString()</code> method of the object.</p></li><li><p>If you are using members of the type <code class="classname">Nullables.NullableXXX</code> (from the library <a href="#nullables" title="Chapter 11. Nullables">Nullables</a>), then they will be mapped to <code class="classname">Nullables.NHibernate.NullableXXXType</code> automatically; don't set <code class="literal">Type="..."</code> in <code class="classname">[Property]</code> (leave it null). Thanks to <span class="emphasis"><em>Michael Third</em></span> for the idea :)</p></li><li><p>Each stream generated by NHibernate.Mapping.Attributes can contain a comment with the date of the generation; You may enable/disable this by using the method <code class="methodname">WriteDateComment</code>.</p></li><li><p>If you forget to provide a required xml attribute, it will obviously throw an exception while generating the mapping.</p></li><li><p>The recommended and easiest way to map <code class="classname">[Component]</code> is to use <code class="classname">[ComponentProperty]</code>. The first step is to put <code class="classname">[Component]</code> on the component class and map its fields/properties. Note that you shouldn't set the <code class="methodname">Name</code> in <code class="classname">[Component]</code>. Then, on each member in your classes, add <code class="classname">[ComponentProperty]</code>. But you can't override <code class="methodname">Access</code>, <code class="methodname">Update</code> or <code class="methodname">Insert</code> for each member.</p><p>There is a working example in <span class="emphasis"><em>NHibernate.Mapping.Attributes.Test</em></span> (look for the class <code class="classname">CompAddress</code> and its usage in others classes).</p><p>One last thing: <code class="classname">ComponentPropertyAttribute</code> inherits from <code class="classname">DynamicComponentAttribute</code> to easily write it just after <code class="literal">&lt;component&gt;</code> elements in the XML stream.</p></li><li><p>Another way to map <code class="classname">[Component]</code> is to use the way this library works: If a mapped class contains a mapped component, then this component will be include in the class. <span class="emphasis"><em>NHibernate.Mapping.Attributes.Test</em></span> contains the classes <code class="classname">JoinedBaz</code> and <code class="classname">Stuff</code> which both use the component <code class="classname">Address</code>.</p><p>Basically, it is done by adding </p><pre class="programlisting">[Component(Name = "MyComp")] private class SubComp : Comp {}</pre><p> in each class. One of the advantages is that you can override <code class="methodname">Access</code>, <code class="methodname">Update</code> or <code class="methodname">Insert</code> for each member. But you have to add the component subclass in <span class="strong"><strong>each</strong></span> class (and it can not be inherited).</p></li><li><p><b>About customization. </b><code class="classname">HbmSerializer</code> uses <code class="classname">HbmWriter</code> to serialize each kind of attributes. Their methods are virtual; so you can create a subclass and override any method you want (to change its default behavior).</p><p>Use the property <code class="methodname">HbmSerializer.HbmWriter</code> to change the writer used (you may set a subclass of <code class="classname">HbmWriter</code>).</p></li></ul></div><p>Example using some this tips: (0, 1 and 2 are position indexes)
</p><pre class="programlisting">
    [NHibernate.Mapping.Attributes.Id(0, TypeType=typeof(int))] // Don't put it after [ManyToOne] !!!
        [NHibernate.Mapping.Attributes.Generator(1, Class="uuid.hex")]
    [NHibernate.Mapping.Attributes.ManyToOne(2, ClassType=typeof(Foo), OuterJoin=OuterJoinStrategy.True)]
    private Foo Entity;
</pre><p>
			Generates:
</p><pre class="programlisting">
    &lt;id type="Int32"&gt;
        &lt;generator class="uuid.hex" /&gt;
    &lt;/id&gt;
    &lt;many-to-one name="Entity" class="Namespaces.Foo, SampleAssembly" outer-join="true" /&gt;
</pre><p>
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-attributes-todo"></a>9.3. Know issues and TODOs</h2></div></div></div><p>First, read TODOs in the source code ;)</p><p>A <code class="methodname">Position</code> property has been added to all attributes to order them. But there is still a problem:</p><p>When a parent element "p" has a child element "x" that is also the child element of another child element "c" of "p" (preceding "x") :D
Illustration:</p><pre class="programlisting">
    &lt;p&gt;
        &lt;c&gt;
            &lt;x /&gt;
        &lt;/c&gt;
        &lt;x /&gt;
    &lt;/p&gt;
</pre><p>
		</p><p>In this case, when writing:
			</p><pre class="programlisting">
    [Attributes.P(0)]
        [Attributes.C(1)]
            [Attributes.X(2)]
        [Attributes.X(3)]
    public MyType MyProperty;</pre><p>
		X(3) will always belong to C(1) ! (as X(2)).
		</p><p>It is the case for <code class="literal">&lt;dynamic-component&gt;</code> and <code class="literal">&lt;nested-composite-element&gt;</code>.</p><p>Another bad news is that, currently, XML elements coming after this elements can not be included in them. Eg: There is no way put a collection in <code class="literal">&lt;dynamic-component&gt;</code>. The reason is that the file <code class="filename">nhibernate-mapping-2.0.xsd</code> tells how elements are built and in which order, and NHibernate.Mapping.Attributes use this order.</p><p>Anyway, the solution would be to add a <code class="methodname">int ParentNode</code> property to BaseAttribute so that you can create a real graph...</p><p>Actually, there is no other know issue nor planned modification. This library should be stable and complete; but if you find a bug or think of an useful improvement, <a href="#support" title="Chapter 12. More information and support">contact us</a>!</p><p>On side note, it would be nice to write a better TestFixture than <span class="emphasis"><em>NHibernate.Mapping.Attributes.Test</em></span> :D</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mapping-attributes-devnotes"></a>9.4. Developer Notes</h2></div></div></div><p>Any change to the schema (<code class="filename">nhibernate-mapping-2.0.xsd</code>) implies:</p><div class="itemizedlist"><ul type="disc"><li><p>Checking if there is any change to do in the Generator (like updating KnowEnums / AllowMultipleValue / IsRoot / IsSystemType / IsSystemEnum / CanContainItself)</p></li><li><p>Updating <code class="filename">/src/NHibernate.Mapping.Attributes/nhibernate-mapping-2.0.xsd</code> (copy/paste) and running the Generator again (even if it wasn't modified)</p></li><li><p>Running the Test project and make sure that no exception is thrown. A class/property should be modified/added in this project to be sure that any new breaking change will be caught (=&gt; update the reference hbm.xml files and/or the project <code class="filename">NHibernate.Mapping.Attributes-1.1.csproj</code>)</p></li></ul></div><p>This implementation is based on NHibernate mapping schema; so there is probably lot of "standard schema features" that are not supported...</p><p>The version of NHibernate.Mapping.Attributes should be the version of the NHibernate schema used to generate it (=&gt; the version of NHibernate library).</p><p>In the design of this project, performance is a (<span class="emphasis"><em>very</em></span>) minor goal :) Easier implementation and maintenance are far more important.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="tool-hbm2net"></a>Chapter 10. NHibernate.Tool.hbm2net</h2></div></div></div><div class="abstract"><a name="NHibernate.Tool.hbm2net-abstract"></a><p class="title"><b>What is NHibernate.Tool.hbm2net?</b></p><p><b>NHibernate.Tool.hbm2net is an add-in for <a href="http://www.nhibernate.org" target="_blank">NHibernate</a>. </b>It makes it possible to generate source files from hbm.xml mapping files.</p><p>In the directory <code class="filename">NHibernate.Tasks</code>, there is a tool called <span><strong class="command">Hbm2NetTask</strong></span> that you can use to automate your build process (using NAnt)</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="nullables"></a>Chapter 11. Nullables</h2></div></div></div><div class="abstract"><a name="Nullables-abstract"></a><p class="title"><b>What is Nullables?</b></p><p><b>Nullables is an add-in for <a href="http://www.nhibernate.org" target="_blank">NHibernate</a> contributed by Donald L Mull Jr. (aka <span class="emphasis"><em>luggage</em></span>). </b>Most database systems allow base types (like <code class="classname">int</code> or <code class="classname">bool</code>) to be null. This means that a boolean column can take the values <span class="emphasis"><em>0</em></span>, <span class="emphasis"><em>1</em></span> or <span class="emphasis"><em>null</em></span>, where <span class="emphasis"><em>null</em></span> doesn't have the same meaning as <span class="emphasis"><em>0</em></span>. But it is not possible with .NET 1.x; a bool is always either true or false.</p><p>Nullables makes it possible to use nullable base types in NHibernate. Note that .NET 2.0 has this feature.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Nullables-howto"></a>11.1. How to use it?</h2></div></div></div><p>Here is a simple example that uses a <code class="classname">Nullables.NullableDateTime</code> to (optionally) store the date of birth for a <code class="classname">Person</code>.</p><pre class="programlisting">
public <span class="strong"><strong>class Person</strong></span>
{
    int _id;
    string _name;
    <span class="strong"><strong>Nullables.NullableDateTime</strong></span> _dateOfBirth;

    public Person()
    {
    }

    public int Id
    {
        get { return this._id; }
    }

    public string Name
    {
        get { return this._name; }
        set { this._name = value; }
    }

    public <span class="strong"><strong>Nullables.NullableDateTime</strong></span> DateOfBirth
    {
        get { return this._dateOfBirth; }
        set { this._dateOfBirth = value; }
    }
}</pre><p>As you can see, <span class="emphasis"><em>DateOfBirth</em></span> has the type <code class="classname">Nullables.NullableDateTime</code> (instead of <code class="classname">System.DateTime</code>).</p><p>Here is the mapping</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8" ?&gt; 
&lt;hibernate-mapping xmlns="urn:nhibernate-mapping-2.0"&gt;
    &lt;class name="Example.Person, Example" table="Person"&gt;
        &lt;id name="Id" access="field.camelcase-underscore" unsaved-value="0"&gt;
            &lt;generator class="native" /&gt;
        &lt;/id&gt;
        &lt;property name="Name" type="String" length="200" /&gt;
        &lt;property name="<span class="emphasis"><em>DateOfBirth</em></span>" type="<span class="strong"><strong>Nullables.NHibernate.NullableDateTimeType</strong></span>, Nullables.NHibernate" /&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>In the mapping, the type of <span class="emphasis"><em>DateOfBirth</em></span>
				<span class="strong"><strong>must</strong></span> be <code class="classname">Nullables.NHibernate.NullableDateTimeType</code>. Note that <a href="#mapping-attributes" title="Chapter 9. NHibernate.Mapping.Attributes">NHibernate.Mapping.Attributes</a> handles that automatically.</p><p><code class="classname">Nullables.NHibernate.NullableXXXType</code>s are wrapper types used to translate Nullables types to Database types.</p></div><p>Here is a piece of code using this example:</p><pre class="programlisting">
Person per = new Person();

textBox1.Text = per.DateOfBirth.Value.ToString() // will throw an exception when there is no value.

textBox1.Text = per.DateOfBirth.ToString() // will work. it will return an empty string if there is no value.

textBox1.Text = (per.DateOfBirth.HasValue ? per.DateOfBirth.Value.ToShortDateString() : "Unknown") // friendly message

per.DateOfBirth = new System.DateTime(1979, 11, 8); // implicit cast from the "plain" System.DateTime.
per.DateOfBirth = new NullableDateTime(new System.DateTime(1979, 11, 8)); // the long way.

per.DateOfBirth = null; // this works.
per.DateOfBirth = NullableDateTime.Default; // this is more correct.</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="support"></a>Chapter 12. More information and support</h2></div></div></div><p><b>If you need more information and support. </b>First, read this documentation! Check out the <a href="http://wiki.nhibernate.org/display/NH/Documentation" target="_blank">online NHibernate documentation</a> (contains the lastest articles) and read <a href="http://nhibernate.sourceforge.net/forum/viewtopic.php?t=25" target="_blank">How To Ask For Help</a>.</p><p>Since this is an <span class="bold"><strong>Open Source project</strong></span> which most of us work on in our spare time, you will be getting a limited support. If you do find a bug or have a comment, you can post it on the <a href="http://nhibernate.sourceforge.net/forum/" target="_blank">NHibernate forum</a> or use the <a href="http://jira.nhibernate.org/" target="_blank">bug tracker</a> or the <a href="http://sourceforge.net/mail/?group_id=29446" target="_blank">development mailing list</a>. We'll try really hard to help you out.</p><p>We love getting feedback, so don't hesitate to contact us!</p><p><span class="emphasis"><em>The NHibernate Team</em></span>.</p></div></div></body></html>
